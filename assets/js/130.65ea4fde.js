(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{539:function(t,s,a){"use strict";a.r(s);var e=a(21),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("在上一篇 "),s("RouterLink",{attrs:{to:"/pages/6caa6f/"}},[t._v("Flutter - 引擎调试（iOS篇）🛠")]),t._v(" 中，我们已经知道了如何去编译调试引擎，今天就来说一说我从调试到提交 "),s("code",[t._v("PR")]),t._v(" 的过程吧。")],1),t._v(" "),s("h2",{attrs:{id:"一、背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、背景"}},[t._v("#")]),t._v(" 一、背景")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("Flutter")]),t._v(" 官方仓库发现了别人提的一个 "),s("code",[t._v("issue")]),t._v("，是关于苹果移动光标的特性功能，先给大家看看该功能的官方演示吧")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020948522.gif",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("issue")]),t._v(" 链接: "),s("a",{attrs:{href:"https://github.com/flutter/flutter/issues/122139",target:"_blank",rel:"noopener noreferrer"}},[t._v("[iOS] Hold and drag spacebar does not move cursor when obscureText is true."),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("问题复现的动图如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020949821.gif",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("issue")]),t._v(" 问题总结：")]),t._v(" "),s("p",[s("code",[t._v("Flutter")]),t._v(" 的 "),s("code",[t._v("TextFormField")]),t._v(" 或 "),s("code",[t._v("TextField")]),t._v(" ，在"),s("code",[t._v("obscureText")]),t._v(" 的初始值和切换值的这两种情况下，长按空格并拖拽时可移动光标这一特性，出现了有别于原生控件的表现，具体如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("    行为"),s("br"),t._v("端")]),t._v(" "),s("th",[t._v("获得焦点"),s("br"),t._v("obscureText=false"),s("br"),t._v("(当前状态: 明文)")]),t._v(" "),s("th",[t._v("切换"),s("br"),t._v("obscureText=true"),s("br"),t._v("(当前状态: 密文)")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Flutter 的 TextField")]),t._v(" "),s("td",[t._v("可用")]),t._v(" "),s("td",[s("code",[t._v("可用")])])]),t._v(" "),s("tr",[s("td",[t._v("原生的 UITextField")]),t._v(" "),s("td",[t._v("可用")]),t._v(" "),s("td",[t._v("不可用")])])])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("    行为"),s("br"),t._v("端")]),t._v(" "),s("th",[t._v("获得焦点"),s("br"),t._v("obscureText=true"),s("br"),t._v("(当前状态: 密文)")]),t._v(" "),s("th",[t._v("切换"),s("br"),t._v("obscureText=false"),s("br"),t._v("(当前状态: 明文)")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Flutter 的 TextField")]),t._v(" "),s("td",[t._v("不可用")]),t._v(" "),s("td",[s("code",[t._v("不可用")])])]),t._v(" "),s("tr",[s("td",[t._v("原生的 UITextField")]),t._v(" "),s("td",[t._v("不可用")]),t._v(" "),s("td",[t._v("可用")])])])]),t._v(" "),s("p",[t._v("可以看到，正常的表现应该是只要是明文，则该功能就可用，而密文时则该功能不可用，但是此时在 "),s("code",[t._v("Flutter")]),t._v(" 端，该功能可不可用取决于获取焦点时是否为明文！")]),t._v(" "),s("p",[t._v("这里贴出 "),s("code",[t._v("issue")]),t._v(" 中给出的示例代码：")]),t._v(" "),s("div",{staticClass:"language-dart extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dart"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'package:flutter/material.dart'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyHomePage")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StatefulWidget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyHomePage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Key")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("State")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyHomePage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_MyHomePageState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" _MyHomePageState "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("State")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyHomePage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" _controller "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextEditingController")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  bool _obscureText "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token metadata function"}},[t._v("@override")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BuildContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Scaffold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      appBar"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppBar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Flutter Demo'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Padding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        padding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EdgeInsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("symmetric")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("horizontal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        child"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Column")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          children"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SizedBox")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("height"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextFormField")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n              controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              obscureText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" _obscureText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              decoration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InputDecoration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                suffixIcon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IconButton")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                  icon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Icon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    _obscureText "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Icons")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibility_off "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Icons")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("visibility"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                  onPressed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                      _obscureText "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("_obscureText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("接下来我们一起去探索一下引擎源码，找到出现问题的根本原因。")]),t._v(" "),s("h2",{attrs:{id:"二、探索"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、探索"}},[t._v("#")]),t._v(" 二、探索")]),t._v(" "),s("h3",{attrs:{id:"_1、引擎准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、引擎准备"}},[t._v("#")]),t._v(" 1、引擎准备")]),t._v(" "),s("p",[t._v("配置 "),s("code",[t._v(".gclient")]),t._v("，将 "),s("code",[t._v("url")]),t._v(" 改成你自己 "),s("code",[t._v("fork")]),t._v(" 的仓库的 "),s("code",[t._v("git")]),t._v(" 地址")]),t._v(" "),s("blockquote",[s("p",[t._v("这样方便我们后续调试完成后，直接将修改的代码提交至自己仓库，顺带提 "),s("code",[t._v("PR")])])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("solutions = "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ...\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@github.com:LinXunFeng/engine.git@dd91363757dd2e8e4dc22d3be62741d461ceb005"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    ...\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("关联调试源码的操作可在上一篇 "),s("RouterLink",{attrs:{to:"/pages/6caa6f/"}},[t._v("Flutter - 引擎调试（iOS篇）🛠")]),t._v(" 中查看，加上篇幅限制，所以这里就不再赘述，本文重点是解决 "),s("code",[t._v("issue")]),t._v(" 提及的问题。")],1),t._v(" "),s("h3",{attrs:{id:"_2、查找病因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、查找病因"}},[t._v("#")]),t._v(" 2、查找病因")]),t._v(" "),s("p",[t._v("在引擎中，与 "),s("code",[t._v("TextField")]),t._v(" 相关的类为 "),s("code",[t._v("FlutterTextInputPlugin")]),t._v("，在该类的所在文件中找到 "),s("code",[t._v("obscureText")]),t._v(" 定义的常量 "),s("code",[t._v("kSecureTextEntry")])]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("pragma")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[t._v("mark "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" TextInputConfiguration Field Names")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" NSString"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" kSecureTextEntry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"obscureText"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("搜索 "),s("code",[t._v("kSecureTextEntry")]),t._v("，发现了除 "),s("code",[t._v("init")]),t._v(" 方法之外，仅在方法 "),s("code",[t._v("configureWithDictionary")]),t._v(" 中以 "),s("code",[t._v("kSecureTextEntry")]),t._v(" 做为 "),s("code",[t._v("key")]),t._v(" 向 "),s("code",[t._v("configuration")]),t._v(" 取值并将值赋予 "),s("code",[t._v("secureTextEntry")]),t._v(" 属性")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("configureWithDictionary"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSDictionary"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("configuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("secureTextEntry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kSecureTextEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" boolValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("因为移动光标的功能与是否明文相关，所以我们可以想到这个 "),s("code",[t._v("secureTextEntry")]),t._v(" 必定是在哪里有被使用到。")]),t._v(" "),s("p",[t._v("如果我们把 "),s("code",[t._v("secureTextEntry")]),t._v(" 相关的代码注释个遍去排查，这无异于大海捞针，该方式也过于笨拙，且明确告诉你徒劳无功，那怎么办呢？🤔")]),t._v(" "),s("p",[t._v("是的，重写它的 "),s("code",[t._v("getter")]),t._v(" 方法，并打个断点")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020949382.png",alt:""}})]),t._v(" "),s("p",[t._v("这里可别忘了先编译！")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" ios_debug_unopt\n")])])]),s("p",[t._v("点击输入框获取焦点，"),s("code",[t._v("Xcode")]),t._v(" 来到断点处，注意看左边的调用栈")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020949907.png",alt:""}})]),t._v(" "),s("p",[t._v("发现 "),s("code",[t._v("isSecureTextEntry")]),t._v(" 是被系统调用的！")]),t._v(" "),s("p",[t._v("调用栈向下找，发现是 "),s("code",[t._v("_activeView")]),t._v(" 成为第一响应者后间接触发的")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020950488.png",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("activeView")]),t._v(" 的声明：")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FlutterTextInputPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" retain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" FlutterTextInputView"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" activeView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@end")]),t._v("\n")])])]),s("p",[s("code",[t._v("FlutterTextInputView")]),t._v(" 的声明：")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@interface")]),t._v(" FlutterTextInputView "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UIView "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("UITextInput"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" UIScribbleInteractionDelegate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// UITextInputTraits")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("isSecureTextEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" BOOL secureTextEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[s("code",[t._v("UITextInput")]),t._v(" -> "),s("code",[t._v("UIKeyInput")]),t._v(" -> "),s("code",[t._v("UITextInputTraits")])]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@protocol")]),t._v(" UITextInput "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("UIKeyInput"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@end")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@protocol")]),t._v(" UIKeyInput "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("UITextInputTraits"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@end")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@protocol")]),t._v(" UITextInputTraits "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NSObject"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nonatomic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("getter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("isSecureTextEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" BOOL secureTextEntry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// default is NO")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@end")]),t._v("\n")])])]),s("p",[t._v("可以发现 "),s("code",[t._v("FlutterTextInputView")]),t._v(" 最终遵守了 "),s("code",[t._v("UITextInputTraits")]),t._v(" 协议，该协议声明了 "),s("code",[t._v("secureTextEntry")]),t._v(" 属性，而该属性不仅决定着原生控件显示明文或密文，还控制着键盘是否可以长按移动光标。")]),t._v(" "),s("p",[t._v("现在来看一下 "),s("code",[t._v("FlutterTextInputPlugin.mm")]),t._v(" 文件中的 "),s("code",[t._v("handleMethodCall")]),t._v(" 方法，其是处理 "),s("code",[t._v("Flutter")]),t._v(" 与引擎交互的 "),s("code",[t._v("method channel")]),t._v(" 的方法")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("handleMethodCall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FlutterMethodCall"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("call result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FlutterResult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("result "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  NSString"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  id args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" call"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("method isEqualToString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kHideMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TextInput.hide")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" hideTextInput"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("result")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("method isEqualToString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kSetClientMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TextInput.setClient")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" setTextInputClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" intValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" withConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("result")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("TextInput.setClient")]),t._v(": 这是在输入框获取焦点的时候与原生控件建立事务时传递的方法名，与之相对应的是 "),s("code",[t._v("setTextInputClient")]),t._v(" 方法，在该方法内创建新的 "),s("code",[t._v("FlutterTextInputView")]),t._v(" 控件，并赋值给 "),s("code",[t._v("activeView")])]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("setTextInputClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("client withConfiguration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSDictionary"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("configuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" resetAllClientIds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Hide all input views from autofill, only make those in the new configuration visible")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// to autofill.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" changeInputViewsAutofillVisibility"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Update the current active view.")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AutofillTypeOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" kFlutterAutofillTypeNone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeView "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" createInputViewWith"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" kFlutterAutofillTypeRegular"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If the group does not involve password autofill, only install the")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// input view that's being focused.")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeView "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" updateAndShowAutofillViews"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("nil\n                                            focusedField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("configuration\n                                       isPasswordRelated"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" kFlutterAutofillTypePassword"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("activeView "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" updateAndShowAutofillViews"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kAssociatedAutofillFields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n                                            focusedField"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("configuration\n                                       isPasswordRelated"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("YES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_activeView setTextInputClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_activeView reloadInputViews"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" cleanUpViewHierarchy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("NO clearText"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("YES delayRemoval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("YES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("并在下图的方法调用栈内可以看到最后是调用了 "),s("code",[t._v("addToInputParentViewIfNeeded")]),t._v(" 方法将 "),s("code",[t._v("activeView")]),t._v(" 视图添加到 "),s("code",[t._v("inputHider")]),t._v(" 视图上。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020950215.png",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("inputHider")]),t._v(" 视图也在该方法中被添加到 "),s("code",[t._v("_viewController.view")]),t._v(" 上")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UIView"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("hostView "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  UIView"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" host "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _viewController"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSAssert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" nullptr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"The application must have a host view since the keyboard client "')]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"must be part of the responder chain to function. The host view controller is %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n           _viewController"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("code",[t._v("TextInput.hide")]),t._v(": 这是当输入框失去焦点的时候传递的方法名，用于移除当前的 "),s("code",[t._v("activeView")]),t._v(" 视图 和 "),s("code",[t._v("_inputHider")]),t._v(" 视图，对应的方法如下：")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("hideTextInput "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),t._v(" removeEnableFlutterTextInputViewAccessibilityTimer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  _activeView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("accessibilityEnabled "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_activeView resignFirstResponder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_activeView removeFromSuperview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("_inputHider removeFromSuperview"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("在此做一个小小的总结："),s("code",[t._v("Flutter")]),t._v(" 的 "),s("code",[t._v("TextField")]),t._v(" 在每一次获取焦点时，引擎端会创建一个相应的 "),s("code",[t._v("FlutterTextInputView")]),t._v(" 原生控件与之对应，并使用 "),s("code",[t._v("activeView")]),t._v(" 来记录当前获取了焦点的那个控件，当失去焦点时，相应的控件会被移除和销毁。")])]),t._v(" "),s("p",[t._v("断点放行后点击眼睛按钮，将输入框切换为密文，你会发现 "),s("code",[t._v("isSecureTextEntry")]),t._v(" 的 "),s("code",[t._v("getter")]),t._v(" 方法并不会被调用，这就是病因，此时虽然从 "),s("code",[t._v("Flutter")]),t._v(" 的 "),s("code",[t._v("TextField")]),t._v(" 的显示来看确实是有在进行明文与密文的切换，但是这只是 "),s("code",[t._v("Flutter")]),t._v(" 处理后的显示结果，而在引擎端的 "),s("code",[t._v("activeView")]),t._v(" 的 "),s("code",[t._v("secureTextEntry")]),t._v(" 还是一开始的值，所以此时长按移动光标的功能还是生效的。")]),t._v(" "),s("p",[t._v("因此，要解决这个问题就得让 "),s("code",[t._v("activeView")]),t._v(" 的 "),s("code",[t._v("secureTextEntry")]),t._v(" 得到更新，并且调用 "),s("code",[t._v("reloadInputViews")]),t._v(" 重新绘制键盘。")]),t._v(" "),s("h2",{attrs:{id:"三、动手解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、动手解决"}},[t._v("#")]),t._v(" 三、动手解决")]),t._v(" "),s("blockquote",[s("p",[t._v("注: "),s("code",[t._v("TextInput.updateConfig")]),t._v(" 该常量在 "),s("code",[t._v("Flutter")]),t._v(" 源码里是早就存在的，但是仅在引擎的 "),s("code",[t._v("Web")]),t._v(" 端使用到，引擎的 "),s("code",[t._v("iOS")]),t._v(" 端则没有使用。")])]),t._v(" "),s("h3",{attrs:{id:"_1、engine-仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、engine-仓库"}},[t._v("#")]),t._v(" 1、"),s("code",[t._v("engine")]),t._v(" 仓库")]),t._v(" "),s("p",[s("code",[t._v("FlutterTextInputPlugin.mm")])]),t._v(" "),s("p",[t._v("新增 "),s("code",[t._v("TextInput.updateConfig")]),t._v(" 常量 "),s("code",[t._v("kUpdateConfigMethod")])]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('  static NSString* const kSetSelectionRectsMethod = @"Scribble.setSelectionRects";\n')]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('  static NSString* const kStartLiveTextInputMethod = @"TextInput.startLiveTextInput";\n')])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('  static NSString* const kUpdateConfigMethod = @"TextInput.updateConfig";\n')])])])])]),s("p",[t._v("补充处理 "),s("code",[t._v("TextInput.updateConfig")]),t._v(" 的方法 "),s("code",[t._v("updateConfig")])]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" NSString* method = call.method;\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" id args = call.arguments;\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" if ([method isEqualToString:kShowMethod]) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" } else if ([method isEqualToString:kStartLiveTextInputMethod]) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   [self startLiveTextInput];\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   result(nil);\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("  } else if ([method isEqualToString:kUpdateConfigMethod]) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    [self updateConfig:args];\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    result(nil);\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" } else {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   result(FlutterMethodNotImplemented);\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" }\n")])])])])]),s("p",[t._v("更新 "),s("code",[t._v("secureTextEntry")]),t._v(" 并调用 "),s("code",[t._v("reloadInputViews")]),t._v(" 方法")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("  - (void)updateConfig:(NSDictionary*)dictionary {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    BOOL isSecureTextEntry = [dictionary[kSecureTextEntry] boolValue];\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    for (UIView* view in self.textInputViews) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("      if ([view isKindOfClass:[FlutterTextInputView class]]) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        FlutterTextInputView* inputView = (FlutterTextInputView*)view;\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // The feature of holding and draging spacebar to move cursor is affected by\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // secureTextEntry, so when obscureText is updated, we need to update secureTextEntry\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // and call reloadInputViews.\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // https://github.com/flutter/flutter/issues/122139\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        if (inputView.isSecureTextEntry != isSecureTextEntry) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("          inputView.secureTextEntry = isSecureTextEntry;\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("          [inputView reloadInputViews];\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        }\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("      }\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    }\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("  }\n")])])])])]),s("h3",{attrs:{id:"_2、flutter-仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、flutter-仓库"}},[t._v("#")]),t._v(" 2、"),s("code",[t._v("flutter")]),t._v(" 仓库")]),t._v(" "),s("p",[s("code",[t._v("editable_text.dart")])]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" @override\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" void didUpdateWidget(EditableText oldWidget) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   super.didUpdateWidget(oldWidget);\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   \n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("     if (_hasInputConnection) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       if (oldWidget.obscureText != widget.obscureText) {\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("         _textInputConnection!.updateConfig(_effectiveAutofillClient.textInputConfiguration);\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       }\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("     }\n")])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" }\n")])])])])]),s("p",[t._v("这样就修复好了，别忘了先执行 "),s("code",[t._v("ninja -C ios_debug_unopt")]),t._v(" 进行编译，然后再进行调试验证。")]),t._v(" "),s("p",[t._v("经过调试，一切正常，接下来就是提交 "),s("code",[t._v("PR")]),t._v(" 了吗？不，要先添加单元测试，不过具体的单测代码不是重点，所以这里只说明如何去跑单测。")]),t._v(" "),s("h2",{attrs:{id:"四、单元测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、单元测试"}},[t._v("#")]),t._v(" 四、单元测试")]),t._v(" "),s("p",[t._v("跑单元测试前需先执行如下命令，确保你的 "),s("code",[t._v("engine/src/out")]),t._v(" 目录下文件齐全")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# engine/src/flutter/tools")]),t._v("\n\n./gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n./gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ios")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n./gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ios")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--simulator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# engine/src/out")]),t._v("\n\nninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" host_debug_unopt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\nninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" ios_debug_unopt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\nninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" ios_debug_sim_unopt\n")])])]),s("h3",{attrs:{id:"_1、脚本跑单测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、脚本跑单测"}},[t._v("#")]),t._v(" 1、脚本跑单测")]),t._v(" "),s("blockquote",[s("p",[t._v("注: 请提前打开 "),s("code",[t._v("iOS")]),t._v(" 模拟器，执行 "),s("code",[t._v("run_tests.py")]),t._v(" 跑单元测试时需要用到")])]),t._v(" "),s("p",[t._v("跑脚本单元测试，执行如下命令即可")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# engine/src/flutter/testing")]),t._v("\n\n./run_tests.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objc\n")])])]),s("p",[t._v("如果报错了，则按其提示先执行相应的命令，完成后再继续执行 "),s("code",[t._v("run_tests.py")])]),t._v(" "),s("p",[t._v("比如这是我执行脚本后的报错内容")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  testing git:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ./run_tests.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("objc\nTraceback "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("most recent call last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/lxf/Desktop/LXF/engine/src/flutter/testing/./run_tests.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1150")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    sys.exit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/lxf/Desktop/LXF/engine/src/flutter/testing/./run_tests.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1136")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" main\n    run_objc_tests"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args.ios_variant, args.objc_filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/lxf/Desktop/LXF/engine/src/flutter/testing/./run_tests.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("682")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" run_objc_tests\n    ensure_ios_tests_are_built"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ios_out_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/lxf/Desktop/LXF/engine/src/flutter/testing/./run_tests.py"')]),t._v(", line "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("585")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ensure_ios_tests_are_built\n    assert os.path.exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tmp_out_dir\nAssertionError: /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_sim_unopt or /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_sim_unopt/libios_test_flutter.dylib doesn't exist. Please run the following commands:\ngn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ios")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v(" --runtime-mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("debug --no-lto "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--simulator")]),t._v("\nautoninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_sim_unopt ios_test_flutter\n")])])]),s("p",[t._v("其实主要原因看这句提示:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("engine/src/out/ios_debug_sim_unopt/libios_test_flutter.dylib doesn't exist\n")])])]),s("p",[t._v("所以我们需要进入到 "),s("code",[t._v("engine/src/out")]),t._v(" 目录下执行如下命令即可")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("autoninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_sim_unopt ios_test_flutter\n")])])]),s("p",[t._v("执行完 "),s("code",[t._v("run_tests.py")]),t._v(" 会自动打开名为 "),s("code",[t._v("IosUnitTestsSimulator")]),t._v(" 的模拟器（该模拟器是以 "),s("code",[t._v("iPhone 11")]),t._v(" 为原型创建的），然后终端会跟随打印单测的执行日志")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("\n** TEST SUCCEEDED **\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\nCommand run successfully "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.46")]),t._v(" seconds: xcrun simctl delete IosUnitTestsSimulator\n")])])]),s("p",[t._v("最终输出 "),s("code",[t._v("TEST SUCCEEDED")]),t._v(" 表示单测全部通过。")]),t._v(" "),s("h3",{attrs:{id:"_2、xcode-跑单测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、xcode-跑单测"}},[t._v("#")]),t._v(" 2、"),s("code",[t._v("Xcode")]),t._v(" 跑单测")]),t._v(" "),s("p",[t._v("接下来介绍一下 "),s("code",[t._v("Xcode")]),t._v(" 跑单元测试，我们用 "),s("code",[t._v("Xcode")]),t._v(" 打开 "),s("code",[t._v("engine/src/flutter/testing/ios/IosUnitTests/IosUnitTests.xcodeproj")])]),t._v(" "),s("p",[t._v("打开后你会发现单测只有 "),s("code",[t._v("FlutterChannelsTest")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020950833.png",alt:""}})]),t._v(" "),s("p",[t._v("别急，按 "),s("code",[t._v("cmd + u")]),t._v(" 跑一遍就全出来了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020951832.png",alt:""}})]),t._v(" "),s("p",[t._v("没错，细心的你会发现截图里 "),s("code",[t._v("SemanticsObjectTest")]),t._v(" 单测失败了，按官方文档的说明，我们需要选择 "),s("code",[t._v("iPhone 11")]),t._v(" 模拟器进行单测。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202304020951260.png",alt:""}})]),t._v(" "),s("p",[t._v("主要原因是下面这行代码过不了，算出来的值不相等")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("XCTAssertTrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGRectEqualToRect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  scrollView"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frame"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CGRectMake")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" effectivelyScale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" effectivelyScale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    w "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" effectivelyScale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" effectivelyScale\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("运行在 "),s("code",[t._v("iPhone 11")]),t._v(" 上的数据")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("scrollView.frame = (2.5 2.5; 25 50)\n\nfloat x = 10;\nfloat y = 10;\nfloat w = 100;\nfloat h = 200;\nfloat effectivelyScale = transformScale / screenScale; // 2.5\n")])])]),s("p",[t._v("运行在 "),s("code",[t._v("iPhone 14 Pro")]),t._v(" 上的数据")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("scrollView.frame = (1.66667 1.66667; 16.6667 33.3333)\n\nfloat x = 10;\nfloat y = 10;\nfloat w = 100;\nfloat h = 200;\nfloat effectivelyScale = transformScale / screenScale; // 0.166666672\n")])])]),s("p",[t._v("这也是为什么 "),s("code",[t._v("run_tests.py")]),t._v(" 脚本是以 "),s("code",[t._v("iPhone 11")]),t._v(" 为原型创建的 "),s("code",[t._v("IosUnitTestsSimulator")]),t._v(" 模拟器。")]),t._v(" "),s("p",[t._v("回归正题，在每一次调整完测试代码后，需要重新执行如下命令重新生成 "),s("code",[t._v("ios_test_flutter.dylib")]),t._v("，否则你的调整不会生效！")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("autoninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_sim_unopt ios_test_flutter\n")])])]),s("p",[t._v("执行完再 "),s("code",[t._v("cmd + u")]),t._v(" 或者单独执行某一条单测。")]),t._v(" "),s("h2",{attrs:{id:"五、提交代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、提交代码"}},[t._v("#")]),t._v(" 五、提交代码")]),t._v(" "),s("p",[t._v("在提交代码前，先执行 "),s("code",[t._v("format.sh")]),t._v(" 进行检查，确保没问题后再提交，有问题则根据提示处理一下代码。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("engine/src/flutter/ci/format.sh\n")])])]),s("p",[t._v("好了，到此所有该做的事情都已经做完了，可以打开自己的仓库，点击 "),s("code",[t._v("Contribute")]),t._v(" -> "),s("code",[t._v("Open pull request")]),t._v(" 去提交 "),s("code",[t._v("PR")]),t._v(" 了。")]),t._v(" "),s("p",[t._v("这里放上我的相关 "),s("code",[t._v("PR")]),t._v(" 链接：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/flutter/engine/pull/40216",target:"_blank",rel:"noopener noreferrer"}},[t._v("引擎 PR"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/flutter/flutter/pull/122383",target:"_blank",rel:"noopener noreferrer"}},[t._v("Flutter PR"),s("OutboundLink")],1)])]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("PR")]),t._v(" 提交时间于 "),s("code",[t._v("2023.03.10")]),t._v("，文章完成时间为 "),s("code",[t._v("2023.04.01")]),t._v("。")])]),t._v(" "),s("p",[t._v("由于我的 "),s("code",[t._v("PR")]),t._v(" 与 "),s("code",[t._v("Flutter")]),t._v(" 成员目前做的一些修复在代码上有重叠的地方，所以 "),s("code",[t._v("PR")]),t._v(" 是否会被合并目前尚未可知。该篇主要记录了结合引擎去调试 "),s("code",[t._v("flutter bug")]),t._v(" 到解决和提交代码的整体流程，供大家参考与相互交流。")]),t._v(" "),s("h2",{attrs:{id:"六、资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、资料"}},[t._v("#")]),t._v(" 六、资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/flutter/flutter/wiki/Testing-the-engine",target:"_blank",rel:"noopener noreferrer"}},[t._v("Testing the engine"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/flutter/engine/blob/master/testing/ios/IosUnitTests/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("IosUnitTests/README.md"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://api.flutter.dev/flutter/services/SystemChannels/textInput-constant.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("textInput constant"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);