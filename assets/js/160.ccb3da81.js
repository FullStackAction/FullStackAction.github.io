(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{570:function(t,a,s){"use strict";s.r(a);var n=s(21),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"一、前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、前言"}},[t._v("#")]),t._v(" 一、前言")]),t._v(" "),a("p",[t._v("如图，这是个非常常见的功能，像淘宝、唯品会、朴朴等 "),a("code",[t._v("App")]),t._v(" 的商品详情页都可以看到。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202508171438642.png",alt:""}})]),t._v(" "),a("p",[t._v("简陋的 "),a("code",[t._v("Demo")]),t._v(" 可科学上网后在线体验:\n"),a("a",{attrs:{href:"https://fluttercandies.github.io/flutter_scrollview_observer/#/detail",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://fluttercandies.github.io/flutter_scrollview_observer/#/detail"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202508171438815.gif",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("顺带提一嘴，朴朴（版本: V5.6.8-0-1c4424）的这个功能有个小 "),a("code",[t._v("bug")]),t._v("，在点击 "),a("code",[t._v("Tab")]),t._v(" 的时候可以将对应模块滚动到 "),a("code",[t._v("TabBar")]),t._v(" 下方，但是它在滑动时却是从列表的顶部开始计算的，所以在点击了第二个 "),a("code",[t._v("Tab")]),t._v(" 后，列表往下稍微滑一点点，就会切回第一个 "),a("code",[t._v("Tab")]),t._v(" 了，是故意的还是不小心？还是故意不小心呢？🤔")])]),t._v(" "),a("p",[t._v("OK，接下来我们就来看看如何通过我的开源库快速实现该功能")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/fluttercandies/flutter_scrollview_observer",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/fluttercandies/flutter_scrollview_observer"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"二、结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、结构"}},[t._v("#")]),t._v(" 二、结构")]),t._v(" "),a("p",[t._v("页面结构很简单，主体为 "),a("code",[t._v("ListView")]),t._v("，"),a("code",[t._v("DetailNavBar")]),t._v(" 内部是使用 "),a("code",[t._v("TabBar")]),t._v(" 来实现的，将其盖在 "),a("code",[t._v("ListView")]),t._v(" 的上方。")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Stack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DetailListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Positioned")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      left"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      right"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DetailNavBar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"三、功能实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、功能实现"}},[t._v("#")]),t._v(" 三、功能实现")]),t._v(" "),a("p",[t._v("我们先来完成滚动过程中更新 "),a("code",[t._v("DetailNavBar")]),t._v(" 的 "),a("code",[t._v("index")]),t._v(" 的功能")]),t._v(" "),a("h3",{attrs:{id:"_1、配置观察"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置观察"}},[t._v("#")]),t._v(" 1、配置观察")]),t._v(" "),a("p",[t._v("创建两个必要的控制器")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScrollController")]),t._v(" scrollController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScrollController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nlate "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListObserverController")]),t._v(" observerController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListObserverController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scrollController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不缓存 item 的偏移量")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 由于我的 ListView 有动态加载的模块，导致模块的偏移量并非固定，")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所以这里设置为 false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果你的 ListView 的模块都是是固定的，则建议设置为 true，这样")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下次可以直接取值跳转，避免计算")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cacheJumpIndexOffset "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("使用 "),a("code",[t._v("ListViewObserver")]),t._v(" 包裹 "),a("code",[t._v("ListView")]),t._v(" 进行观察")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ListView (没什么需要改动的，怎么实现都可以)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" resultWidget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("separated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用 ListViewObserver 包裹 ListView 进行观察")]),t._v("\nresultWidget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListViewObserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 观察控制器")]),t._v("\n  controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("observerController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DetailNavBar 的高度")]),t._v("\n  dynamicLeadingOffset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 观察结果回调")]),t._v("\n  onObserve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" logic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onObserveForListView"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只监听处理第一层滚动通知，即 notification.depth == 0")]),t._v("\n  scrollNotificationPredicate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" defaultScrollNotificationPredicate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" resultWidget"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("这里重点说两个参数")]),t._v(" "),a("p",[t._v("1、"),a("code",[t._v("dynamicLeadingOffset")]),t._v(": 用于设置计算可视区域的偏移量，如图中的绿线，一般情况下，判断 "),a("code",[t._v("ListView")]),t._v(" 的 "),a("code",[t._v("item")]),t._v(" 是否为第一个，主要是看它是否接触绿线，当 "),a("code",[t._v("dynamicLeadingOffset")]),t._v(" 返回的值越大，绿线就越向下偏移，计算的可视区域变小，第一个 "),a("code",[t._v("item")]),t._v(" 也随之变化。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202508171438436.png",alt:""}})]),t._v(" "),a("p",[t._v("所以这里的 "),a("code",[t._v("dynamicLeadingOffset")]),t._v(" 返回了 "),a("code",[t._v("DetailNavBar")]),t._v(" 的高度 "),a("code",[t._v("state.navBarHeight")]),t._v("，就是从 "),a("code",[t._v("DetailNavBar")]),t._v(" 的下方开始计算可视区域，计算第一个 "),a("code",[t._v("item")]),t._v("。")]),t._v(" "),a("p",[t._v("2、"),a("code",[t._v("scrollNotificationPredicate")]),t._v(": 用于是否处理滚动通知，"),a("code",[t._v("ListViewObserver")]),t._v(" 内部是监听滚动通知来触发观察的，但在一些场景下，如 "),a("code",[t._v("item")]),t._v(" 内部有轮播，轮播在每次翻页时也会发出滚动通知，不过其 "),a("code",[t._v("depth")]),t._v(" 大于 "),a("code",[t._v("0")]),t._v("，所以可以用来判断当前的滚动通知是否为被观察的 "),a("code",[t._v("ListView")]),t._v(" 发出的， "),a("code",[t._v("defaultScrollNotificationPredicate")]),t._v(" 是 "),a("code",[t._v("Flutter")]),t._v(" 自带的方法，代码如下：")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// A [ScrollNotificationPredicate] that checks whether")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// `notification.depth == 0`, which means that the notification")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/// did not bubble through any intervening scrolling widgets.")]),t._v("\nbool "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultScrollNotificationPredicate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ScrollNotification")]),t._v(" notification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" notification"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("depth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("为了不改变先前版本的行为，"),a("code",[t._v("scrollview_observer")]),t._v(" 并没有将其设置做为默认值，需要手动配置～")]),t._v(" "),a("h3",{attrs:{id:"_2、处理观察结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、处理观察结果"}},[t._v("#")]),t._v(" 2、处理观察结果")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("ListViewObserver")]),t._v(" 的 "),a("code",[t._v("onObserve")]),t._v(" 回调方法中我们可以拿到观察结果，通过观察结果我们就可以计算出当前 "),a("code",[t._v("DetailNavBar")]),t._v(" 应该设置的 "),a("code",[t._v("index")]),t._v("。")]),t._v(" "),a("p",[t._v("这里 "),a("code",[t._v("scrollview_observer")]),t._v(" 已经将计算逻辑封装至 "),a("code",[t._v("ObserverUtils.calcAnchorTabIndex")]),t._v(" 方法中，按如下调用即可。")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onObserveForListView")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ListViewObserveModel")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" navBarTabController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarTabController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navBarTabController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 计算 TabBar 的下标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObserverUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("calcAnchorTabIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    observeModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tabIndexes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarTabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    currentTabIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" navBarTabController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新 TabBar 的下标")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateNavBarTabIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateNavBarTabIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("int index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" navBarTabController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarTabController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navBarTabController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  navBarTabController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("传值说明")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ListView")]),t._v(" 有 "),a("code",[t._v("8")]),t._v(" 个模块，对应的下标就是 "),a("code",[t._v("0 ~ 7")])]),t._v(" "),a("li",[a("code",[t._v("DetailNavBar")]),t._v(" 显示的是 "),a("code",[t._v("模块 1、4、7")]),t._v(" 的 "),a("code",[t._v("Tab")]),t._v("，对应模块的下标就是 "),a("code",[t._v("[0, 3, 6]")])])]),t._v(" "),a("p",[t._v("上述 "),a("code",[t._v("calcAnchorTabIndex")]),t._v(" 方法中的 "),a("code",[t._v("tabIndexes")]),t._v("，传入的就是 "),a("code",[t._v("[0, 3, 6]")]),t._v("，然后计算出 "),a("code",[t._v("DetailNavBar")]),t._v(" 对应的 "),a("code",[t._v("[0, 1 ,2]")])]),t._v(" "),a("h3",{attrs:{id:"_3、点击跳转"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、点击跳转"}},[t._v("#")]),t._v(" 3、点击跳转")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleNavBarTabTap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("int index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hasClients"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" tabModel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarTabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" moduleIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" tabModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第一个模块，直接回到顶部")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("moduleIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scrollController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jumpTo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 其它模块")]),t._v("\n  state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("observerController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jumpTo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" moduleIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navBarHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("点击跳转第一个模块时，我们是知道偏移量的，直接 "),a("code",[t._v("scrollController.jumpTo(0)")]),t._v(" 即可，避免不必要的计算。")]),t._v(" "),a("p",[t._v("点击跳转其它模块时，使用 "),a("code",[t._v("observerController.jumpTo")]),t._v("，其中 "),a("code",[t._v("offset")]),t._v(" 用于设置向下偏移多少，这里返回了 "),a("code",[t._v("DetailNavBar")]),t._v(" 的高度 "),a("code",[t._v("state.navBarHeight")]),t._v("，即滚动到 "),a("code",[t._v("DetailNavBar")]),t._v(" 的下方。")]),t._v(" "),a("h2",{attrs:{id:"四、最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、最后"}},[t._v("#")]),t._v(" 四、最后")]),t._v(" "),a("p",[t._v("通过上述示例的讲解，相信你对 "),a("code",[t._v("scrollview_observer")]),t._v(" 的使用又更加清楚，开源不易，如果你也觉得这个库好用，请不吝给个 "),a("code",[t._v("Star")]),t._v("  👍 ，并多多支持！")]),t._v(" "),a("p",[t._v("GitHub: "),a("a",{attrs:{href:"https://github.com/fluttercandies/flutter_scrollview_observer",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/fluttercandies/flutter_scrollview_observer"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("本篇到此结束，感谢大家的支持，我们下次再见！ 👋")])])}),[],!1,null,null,null);a.default=e.exports}}]);