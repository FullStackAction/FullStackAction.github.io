(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{548:function(t,s,a){"use strict";a.r(s);var e=a(21),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、概述"}},[t._v("#")]),t._v(" 一、概述")]),t._v(" "),s("p",[t._v("目前我们的项目是按照 "),s("code",[t._v("Flutter")]),t._v(" 官方文档 "),s("a",{attrs:{href:"https://docs.flutter.dev/add-to-app/android/project-setup?tab=module-source",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.flutter.dev/add-to-app/android/project-setup?tab=module-source"),s("OutboundLink")],1),t._v("，以源码依赖的方式集成到原生项目，在集成 "),s("code",[t._v("Shorebird")]),t._v(" 实现热更新时，需要我们将源码依赖的方式调整成二进制依赖。")]),t._v(" "),s("p",[t._v("安卓端的改动还是很简单的，一路下来没怎么碰壁，接下来一起来看看如何操作吧")]),t._v(" "),s("h2",{attrs:{id:"二、shorebird-初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、shorebird-初始化"}},[t._v("#")]),t._v(" 二、Shorebird 初始化")]),t._v(" "),s("p",[t._v("本文以 "),s("code",[t._v("Mac")]),t._v(" 环境为例，如果你是 "),s("code",[t._v("Windows")]),t._v(" 用户，请按官方文档去操作: "),s("a",{attrs:{href:"https://docs.shorebird.dev",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.shorebird.dev"),s("OutboundLink")],1)]),t._v(" "),s("blockquote",[s("p",[t._v("该部分内容只需要一开始没有环境和相应的文件时去操作一次")])]),t._v(" "),s("h3",{attrs:{id:"安装-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-cli"}},[t._v("#")]),t._v(" 安装 CLI")]),t._v(" "),s("p",[t._v("打开终端，执行以下命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--proto")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'=https'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--tlsv1.2")]),t._v(" https://raw.githubusercontent.com/shorebirdtech/install/main/install.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-sSf")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),s("p",[t._v("重启终端，输入 "),s("code",[t._v("shorebird")]),t._v(" 即可看到相应的命令输出")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ shorebird\nThe shorebird command-line tool\n\nUsage: shorebird "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("arguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\nGlobal options:\n-h, "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--help")]),t._v("            Print this usage information.\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v("         Print the current version.\n-v, --"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("no-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("verbose    Noisy logging, including all shell commands executed.\n\nAvailable commands:\n  cache      Manage the Shorebird cache.\n  doctor     Show information about the installed tooling.\n  flutter    Manage your Shorebird Flutter installation.\n  init       Initialize Shorebird.\n  login      Login as a new Shorebird user.\n  login:ci   Login as a CI user.\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("logout")]),t._v("     Logout of the current Shorebird user\n  patch      Manage patches "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" a specific release "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Shorebird.\n  preview    Preview a specific release on a device.\n  release    Manage your Shorebird app releases.\n  upgrade    Upgrade your copy of Shorebird.\n\nRun "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shorebird help <command>"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v(" information about a command.\n")])])]),s("h3",{attrs:{id:"登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),s("p",[t._v("通过如下命令，登录你的 "),s("code",[t._v("Shorebird")]),t._v(" 账号")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("shorebird login\n")])])]),s("h3",{attrs:{id:"选择-flutter-版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择-flutter-版本"}},[t._v("#")]),t._v(" 选择 "),s("code",[t._v("Flutter")]),t._v(" 版本")]),t._v(" "),s("p",[t._v("你可以查看当前 "),s("code",[t._v("Shorebird")]),t._v(" 支持哪些 "),s("code",[t._v("Flutter")]),t._v(" 版本")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("shorebird flutter versions list\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ shorebird flutter versions list\n📦 Flutter Versions\n✓ 3.13.9\n  3.13.8\n  3.13.7\n  3.13.6\n  3.13.5\n  3.13.4\n  3.13.3\n  3.13.2\n  3.13.1\n  3.13.0\n  3.10.7\n  3.10.6\n  3.10.5\n  3.10.4\n  3.10.3\n  3.10.2\n  3.10.1\n  3.10.0\n")])])]),s("p",[t._v("如我现在需要用到  "),s("code",[t._v("Flutter 3.13.9")]),t._v(" 版本，则输入如下命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ shorebird flutter versions use "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.13")]),t._v(".9\n")])])]),s("h3",{attrs:{id:"flutter-模块初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flutter-模块初始化"}},[t._v("#")]),t._v(" Flutter 模块初始化")]),t._v(" "),s("p",[t._v("在你的 "),s("code",[t._v("Flutter")]),t._v(" 项目下执行如下命令")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("shorebird init\n")])])]),s("p",[t._v("该命令会生成在项目根目录生成 "),s("code",[t._v("shorebird.yaml")]),t._v(" 文件")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# shorebird.ymal的内容")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app_id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" xxxxxxxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xxxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xxxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xxxx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("xxxxxxxxxx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# auto_update: false")]),t._v("\n")])])]),s("p",[t._v("以及修改 "),s("code",[t._v("pubspec.yaml")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("assets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" shorebird.yaml\n")])])]),s("h2",{attrs:{id:"三、原生项目改造"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、原生项目改造"}},[t._v("#")]),t._v(" 三、原生项目改造")]),t._v(" "),s("blockquote",[s("p",[t._v("以下的相关修改是以我们项目来写的（"),s("code",[t._v(".kts")]),t._v("），如果你的跟我的不一样，可以看一下文档："),s("a",{attrs:{href:"https://docs.shorebird.dev/guides/hybrid-app/android",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.shorebird.dev/guides/hybrid-app/android"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"build-gradle-kts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#build-gradle-kts"}},[t._v("#")]),t._v(" "),s("code",[t._v("build.gradle.kts")])]),t._v(" "),s("p",[t._v("新增本地二进制依赖")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("buildscript {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   repositories {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("           \n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // 本地依赖Flutter包\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('        maven(url = "../../flutter_module/release")\n')]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('        maven(url = "https://download.shorebird.dev/download.flutter.io")\n')])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       \n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   }\n")])]),t._v("}\n\nallprojects {\n"),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   repositories {\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("           \n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("        // 本地依赖Flutter包\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('        maven(url = "../../flutter_module/release")\n')]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('        maven(url = "https://download.shorebird.dev/download.flutter.io")\n')])]),s("span",{pre:!0,attrs:{class:"token unchanged"}},[s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       \n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("       ...\n")]),s("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[t._v(" ")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("   }\n")])]),t._v("}\n")])])]),s("h3",{attrs:{id:"settings-gradle-kts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#settings-gradle-kts"}},[t._v("#")]),t._v(" "),s("code",[t._v("settings.gradle.kts")])]),t._v(" "),s("p",[t._v("注释掉本地源码依赖")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" evaluate(new File(\n")]),s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("         settingsDir,\n")]),s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('         "../flutter_module/.android/include_flutter.groovy"\n')]),s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" ))\n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" //evaluate(new File(\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" //        settingsDir,\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(' //        "../flutter_module/.android/include_flutter.groovy"\n')]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v(" //))\n")])])])])]),s("h3",{attrs:{id:"app-build-gradle-kts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#app-build-gradle-kts"}},[t._v("#")]),t._v(" "),s("code",[t._v("app/build.gradle.kts")])]),t._v(" "),s("p",[t._v("注释掉本地源码依赖，新增本地二进制依赖")]),t._v(" "),s("div",{staticClass:"language-diff extra-class"},[s("pre",{pre:!0,attrs:{class:"language-diff"}},[s("code",[t._v("dependencies {\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    // Flutter源码依赖\n")])]),s("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[s("span",{pre:!0,attrs:{class:"token prefix deleted"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    implementation(project(LocalLib.flutter))    \n")])]),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    // implementation(project(LocalLib.flutter))\n")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v("    // Flutter二进制依赖\n")]),s("span",{pre:!0,attrs:{class:"token prefix inserted"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token line"}},[t._v('    releaseImplementation("com.lxf.flutter_modules:flutter_release:1.0")\n')])]),t._v("}\n")])])]),s("h2",{attrs:{id:"四、创建-shorebird-release"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、创建-shorebird-release"}},[t._v("#")]),t._v(" 四、创建 Shorebird Release")]),t._v(" "),s("p",[t._v("打发布包的时候操作，在 "),s("code",[t._v("Flutter")]),t._v(" 工程目录下执行")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" xx/xx/flutter_modules\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.0.0+320: 大版本号+小版本号")]),t._v("\nshorebird release aar --release-version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7.0")]),t._v(".0+320\n")])])]),s("blockquote",[s("p",[t._v("该命令内部会去执行 "),s("code",[t._v("flutter build aar --no-debug --no-profile ...")]),t._v("，并且使用的是 "),s("code",[t._v("Shorebird")]),t._v(" 魔改的 "),s("code",[t._v("Flutter")]),t._v(" 引擎！")])]),t._v(" "),s("p",[t._v("版本号可以在如下路径的文件中查看")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[t._v("# 路径: app/src/main/AndroidManifest.xml\n# 小版本号: android:versionCode\n# 大版本号: android:versionName\n\n"),s("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="utf-8"?>')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("manifest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("android")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://schemas.android.com/apk/res/android"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("tools")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://schemas.android.com/tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("package")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.lxf.flutter_modules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("versionCode")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("320"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("android:")]),t._v("versionName")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("7.0.0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n...\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[s("code",[t._v("ShoreBird")]),t._v(" 的内部逻辑会去以这个版本号组合，向服务器请求判断是否存在相应版本的相关补丁！")]),t._v(" "),s("p",[t._v("执行完成后，在 "),s("code",[t._v("Shorebird")]),t._v(" 控制台上可以看到相应的项")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202401071836372.png",alt:""}})]),t._v(" "),s("p",[t._v("在命令执行前，请确保不存在 "),s("code",[t._v("7.0.0+320")]),t._v(" 的 "),s("code",[t._v("Release")]),t._v("，如果有的话，请先删除")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202401071836142.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"五、创建-shorebird-patch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、创建-shorebird-patch"}},[t._v("#")]),t._v(" 五、创建 Shorebird Patch")]),t._v(" "),s("p",[t._v("紧急修复线上包的bug时操作，在 "),s("code",[t._v("Flutter")]),t._v(" 工程目录下执行")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("shorebird patch aar --release-version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7.0")]),t._v(".0+320\n")])])]),s("p",[t._v("注：版本号与上述的 "),s("code",[t._v("release")]),t._v(" 命令中使用的要保持一致！")]),t._v(" "),s("p",[t._v("执行完成后，在 "),s("code",[t._v("Shorebird")]),t._v(" 控制台上点击对应的 "),s("code",[t._v("Release")]),t._v(" 项，进去后可以看到相应的补丁")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202401071837938.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"六、热更新验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、热更新验证"}},[t._v("#")]),t._v(" 六、热更新验证")]),t._v(" "),s("ol",[s("li",[t._v("未打 "),s("code",[t._v("patch")]),t._v(" 时，请以 "),s("code",[t._v("release")]),t._v(" 模式运行原生工程（在 "),s("code",[t._v("Active Build Variant")]),t._v(" 的下拉选项中选择 "),s("code",[t._v("release")]),t._v("）")]),t._v(" "),s("li",[t._v("关闭 "),s("code",[t._v("App")])]),t._v(" "),s("li",[t._v("打 "),s("code",[t._v("patch")]),t._v(" 后，重新打开 "),s("code",[t._v("App")]),t._v("，关闭 "),s("code",[t._v("App")]),t._v(" 再打开 "),s("code",[t._v("App")]),t._v("，即可看到变化")])]),t._v(" "),s("p",[t._v("如果补丁没有生效，可以在 "),s("code",[t._v("Logcat")]),t._v(" 内检测相关输出，成功还是失败可以直接看后两句，如下两种情况的输出：")]),t._v(" "),s("p",[t._v("成功:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO:shorebird.cc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("109")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Shorebird updater: no active patch.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO:shorebird.cc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("113")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting Shorebird update\nupdater::network: Sending patch check request: PatchCheckRequest "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app_id: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx"')]),t._v(", channel: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stable"')]),t._v(", release_version: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7.0.0+320"')]),t._v(", patch_number: None, platform: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android"')]),t._v(", arch: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aarch64"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupdater::updater: Patch "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" successfully installed.\nupdater::updater: Update thread finished with status: Update installed\n")])])]),s("p",[t._v("失败:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO:shorebird.cc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("109")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Shorebird updater: no active patch.\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO:shorebird.cc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("113")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Starting Shorebird update\nupdater::network: Sending patch check request: PatchCheckRequest "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app_id: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxx"')]),t._v(", channel: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stable"')]),t._v(", release_version: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7.0.0+320"')]),t._v(", patch_number: None, platform: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android"')]),t._v(", arch: "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aarch64"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nupdater::updater: Update failed: failed to fill whole buffer\nupdater::updater: Update thread finished with status: Update had error\n")])])]),s("p",[t._v("失败的时候，看一下 "),s("code",[t._v("PatchCheckRequest")]),t._v(" 后面的请求参数输出，一般失败都是因为这里的参数错误才导致。")]),t._v(" "),s("h2",{attrs:{id:"七、脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、脚本"}},[t._v("#")]),t._v(" 七、脚本")]),t._v(" "),s("p",[t._v("由于我们日常研发还是使用的是源码依赖的方式，只会在打最终测试包时才需要去做上述的调整操作，所以这里用我比较熟悉的 "),s("code",[t._v("Python")]),t._v(" 去制作了简易的脚本，并结合 "),s("code",[t._v("Jenkins")]),t._v(" 来辅助完成这种万年不变的无聊步骤")]),t._v(" "),s("p",[t._v("脚本已上传至 "),s("code",[t._v("Github")]),t._v(": "),s("a",{attrs:{href:"https://github.com/LinXunFeng/script_box/tree/main/flutter",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/LinXunFeng/script_box/tree/main/flutter"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("看官可自取修改~")]),t._v(" "),s("h3",{attrs:{id:"switch-flutter-integrate-py"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#switch-flutter-integrate-py"}},[t._v("#")]),t._v(" switch_flutter_integrate.py")]),t._v(" "),s("blockquote",[s("p",[t._v("切换 "),s("code",[t._v("Flutter")]),t._v(" 项目的集成方式")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 二进制依赖")]),t._v("\npython switch_flutter_integrate.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'原生工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'binary'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'android'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 源码依赖")]),t._v("\npython switch_flutter_integrate.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'原生工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'source'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'android'")]),t._v(" \n")])])]),s("h3",{attrs:{id:"shorebird-py"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#shorebird-py"}},[t._v("#")]),t._v(" shorebird.py")]),t._v(" "),s("blockquote",[s("p",[t._v("自动获取版本号，并执行 "),s("code",[t._v("Shorebird")]),t._v(" 相关命令")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# release")]),t._v("\npython shorebird.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'原生工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Flutter工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" release "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" android\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# patch")]),t._v("\npython shorebird.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'原生工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Flutter工程路径'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" patch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" android\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);