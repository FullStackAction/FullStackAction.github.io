(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{520:function(a,e,t){"use strict";t.r(e);var s=t(21),r=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("blockquote",[e("p",[e("code",[a._v("iOS")]),a._v(" 端 "),e("code",[a._v("APP")]),a._v(" 在上线之前，会经过苹果商店进行 "),e("code",[a._v("FairPlayDRM")]),a._v(" 数字版本加密保护，俗称 “加壳”，如果想对应用进行分析，就必须进行 “脱壳”，从而得到未加密的二进制文件")])]),a._v(" "),e("h2",{attrs:{id:"一、检测是否加壳"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、检测是否加壳"}},[a._v("#")]),a._v(" 一、检测是否加壳")]),a._v(" "),e("p",[a._v("介绍两个常用的方式")]),a._v(" "),e("h3",{attrs:{id:"_1、使用-otool-检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用-otool-检测"}},[a._v("#")]),a._v(" 1、使用 "),e("code",[a._v("otool")]),a._v(" 检测")]),a._v(" "),e("p",[a._v("执行如下命令")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("otool "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" Twitter "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" crypt\n")])])]),e("p",[a._v("在得到的结果中，如果 "),e("code",[a._v("cryptid")]),a._v(" 的值为 "),e("code",[a._v("1")]),a._v("，则说明已加壳，如果为 "),e("code",[a._v("0")]),a._v(" 则说明未加壳")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191513156.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"_2、使用-machoview-检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、使用-machoview-检测"}},[a._v("#")]),a._v(" 2、使用 "),e("code",[a._v("MachOView")]),a._v(" 检测")]),a._v(" "),e("p",[a._v("使用 "),e("code",[a._v("MachOView")]),a._v("打开目标文件后，展开 "),e("code",[a._v("Load Commands")]),a._v(" 找到 "),e("code",[a._v("LC_ENCRYPTION_INFO_64")]),a._v("，右侧可以看到 "),e("code",[a._v("Crypt ID")]),a._v("，同上，"),e("code",[a._v("1")]),a._v(" 为已加壳，"),e("code",[a._v("0")]),a._v(" 为未加壳")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191513318.png",alt:""}})]),a._v(" "),e("h2",{attrs:{id:"二、脱壳"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、脱壳"}},[a._v("#")]),a._v(" 二、脱壳")]),a._v(" "),e("p",[a._v("以下罗列常用的脱壳工具，推荐度从上到下依次递减")]),a._v(" "),e("h3",{attrs:{id:"_1、crackerxi"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、crackerxi"}},[a._v("#")]),a._v(" 1、"),e("code",[a._v("CrackerXI")])]),a._v(" "),e("blockquote",[e("p",[e("code",[a._v("CrackerXI")]),a._v(" 的安装和使用都较为简单，是目前为止最为傻瓜式的脱壳工具")])]),a._v(" "),e("p",[a._v("在 "),e("code",[a._v("Cydia")]),a._v(" 中添加源地址 "),e("code",[a._v("http://cydia.iphonecake.com/")]),a._v("，添加完成后搜索 "),e("code",[a._v("CrackerXI")]),a._v("，找到后安装即可。")]),a._v(" "),e("p",[a._v("在进行脱壳前，需要进入 "),e("code",[a._v("Settings")]),a._v(" 页面进行配置，配置如下图所示")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191513574.png",alt:""}})]),a._v(" "),e("p",[a._v("切回 "),e("code",[a._v("AppList")]),a._v(" 页面，点击需要脱壳的 "),e("code",[a._v("App")]),a._v("，在弹出的对话框中选择 "),e("code",[a._v("YES，Full IPA")]),a._v(" 即可。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191514703.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"_2、clutch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、clutch"}},[a._v("#")]),a._v(" 2、"),e("code",[a._v("Clutch")])]),a._v(" "),e("p",[a._v("https://github.com/KJCracks/Clutch")]),a._v(" "),e("p",[a._v("在 "),e("code",[a._v("Release")]),a._v(" 页面找到最新版本的可执行文件，下载后改名为 "),e("code",[a._v("Clutch")]),a._v("，执行下方命令，将 "),e("code",[a._v("Cluth")]),a._v(" 文件复制到 "),e("code",[a._v("iOS")]),a._v(" 设备的 "),e("code",[a._v("/usr/bin")]),a._v(" 目录下")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2222")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" ./Clutch root@localhost:/usr/bin/\n")])])]),e("p",[a._v("登录到 "),e("code",[a._v("iOS")]),a._v(" 设备，给 "),e("code",[a._v("Cluth")]),a._v(" 文件添加执行权限")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lxf-iPad:~ root"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# chmod +x /usr/bin/Clutch")]),a._v("\n")])])]),e("p",[a._v("至于怎么通过端口 "),e("code",[a._v("2222")]),a._v(" 就可以从 "),e("code",[a._v("Mac")]),a._v(" 上传输给 "),e("code",[a._v("iOS")]),a._v(" 设备，以及如何登录到 "),e("code",[a._v("iOS")]),a._v(" 设备，请查看本人的另一篇文章："),e("a",{attrs:{href:"https://juejin.cn/post/7042980829999398920",target:"_blank",rel:"noopener noreferrer"}},[a._v("Mac远程登录到iOS设备"),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("执行 "),e("code",[a._v("Clutch")]),a._v(" 可查看帮助信息")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lxf-iPad:~ root"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Clutch")]),a._v("\nUsage: Clutch "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OPTIONS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-b")]),a._v(" --binary-dump "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" Only dump binary files from specified bundleID\n"),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dump")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        Dump specified bundleID into .ipa "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("file")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" --print-installed     Print installed applications\n   "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--clean")]),a._v("               Clean /var/tmp/clutch directory\n   "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v("             Display version and "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n-? "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("                Display this "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("help")]),a._v(" and "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" --no-color            Print with colors disabled\n")])])]),e("p",[e("code",[a._v("-i")]),a._v(" 参数可以打印从 "),e("code",[a._v("AppStore")]),a._v(" 上下载安装的 "),e("code",[a._v("App")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lxf-iPad:~ root"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Clutch -i")]),a._v("\nInstalled apps:\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(":   Twitter "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("com.atebits.Tweetie"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),e("p",[e("code",[a._v("-d")]),a._v(" 参数可以进行脱壳，这里以 "),e("code",[a._v("Twitter")]),a._v(" 为例")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("Clutch "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" com.atebits.Tweetie2\n")])])]),e("p",[a._v("脱壳后的 "),e("code",[a._v("ipa")]),a._v(" 文件会存放至 "),e("code",[a._v("/private/var/mobile/Documents/Dumped/")]),a._v(" 目录下")]),a._v(" "),e("h3",{attrs:{id:"_3、dumpdecrypted"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、dumpdecrypted"}},[a._v("#")]),a._v(" 3、"),e("code",[a._v("dumpdecrypted")])]),a._v(" "),e("p",[a._v("https://github.com/stefanesser/dumpdecrypted")]),a._v(" "),e("p",[a._v("下载源码，在 "),e("code",[a._v("dumpdecrypted")]),a._v(" 目录下执行 "),e("code",[a._v("make")]),a._v(" 命令编译生成 "),e("code",[a._v("dumpdecrypted.dylib")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入 dumpdecrypted 目录")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" xxx/dumpdecrypted\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进行编译")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v("\n")])])]),e("p",[a._v("编译完成后，目录下就有了 "),e("code",[a._v("dumpdecrypted.dylib")]),a._v(" 文件")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n├── Makefile\n├── README\n├── dumpdecrypted.c\n├── dumpdecrypted.dylib\n└── dumpdecrypted.o\n")])])]),e("p",[a._v("将 "),e("code",[a._v("dumpdecrypted.dylib")]),a._v(" 文件复制 "),e("code",[a._v("iOS")]),a._v(" 设备")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2222")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" ./dumpdecrypted.dylib root@localhost:/usr/bin/\n")])])]),e("p",[a._v("使用 "),e("code",[a._v("ps")]),a._v(" 命令查看目标文件的完整路径")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("lxf-iPad:~ root"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ps -ax | grep Twitter")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("15153")]),a._v(" ??         "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(":00.00 /var/containers/Bundle/Application/3A7C3480-C30B-40D7-A0A4-6C313E42B793/Twitter.app/Twitter\n"),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("15161")]),a._v(" ttys000    "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(":00.02 "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" Twitter\n")])])]),e("p",[a._v("使用 "),e("code",[a._v("DYLD_INSERT_LIBRARIES")]),a._v(" 环境变量将 "),e("code",[a._v("dumpdecrypted.dylib")]),a._v(" 注入就可以脱壳。")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DYLD_INSERT_LIBRARIES")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("dumpdecrypted.dylib /var/containers/Bundle/Application/3A7C3480-C30B-40D7-A0A4-6C313E42B793/Twitter.app/Twitter\n")])])]),e("p",[a._v("执行完成后会在将脱壳后的文件存放到当前目录下")]),a._v(" "),e("h3",{attrs:{id:"_4、frida-ios-dump"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、frida-ios-dump"}},[a._v("#")]),a._v(" 4、frida-ios-dump")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/AloneMonkey/frida-ios-dump",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/AloneMonkey/frida-ios-dump"),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("下载源码后，安装其 "),e("code",[a._v("python")]),a._v(" 脚本所需依赖包")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("pip "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" requirements.tx\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191514736.png",alt:""}})]),a._v(" "),e("p",[e("code",[a._v("-h")]),a._v(" 参数查看帮助")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("python dump.py "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h")]),a._v("\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191514875.png",alt:""}})]),a._v(" "),e("p",[e("code",[a._v("-l")]),a._v(" 参数查看本机已应用 "),e("code",[a._v("App")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("./dump.py "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191514754.png",alt:""}})]),a._v(" "),e("h2",{attrs:{id:"三、取出脱壳文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、取出脱壳文件"}},[a._v("#")]),a._v(" 三、取出脱壳文件")]),a._v(" "),e("h3",{attrs:{id:"_1、爱思助手"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、爱思助手"}},[a._v("#")]),a._v(" 1、爱思助手")]),a._v(" "),e("p",[a._v("以 "),e("code",[a._v("CrackerXI")]),a._v(" 为例，按此路径便可找到脱壳后的文件")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("/private/var/mobile/Documents/CrackerXI/\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191514617.png",alt:""}})]),a._v(" "),e("p",[a._v("找到后选中目的文件，点击左上角的 "),e("code",[a._v("导出")]),a._v(" 按钮，或者右击文件，在弹出的菜单中选中 "),e("code",[a._v("导出")]),a._v(" 按钮即可。")]),a._v(" "),e("h3",{attrs:{id:"_2、scp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、scp"}},[a._v("#")]),a._v(" 2、SCP")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("scp")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("2222")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" root@localhost:/private/var/mobile/Documents/CrackerXI/Twitter_8.61_LXF.ipa ./\n")])])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191515748.png",alt:""}})]),a._v(" "),e("h2",{attrs:{id:"四、验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、验证"}},[a._v("#")]),a._v(" 四、验证")]),a._v(" "),e("p",[a._v("正如文章开头所说的，使用 "),e("code",[a._v("otool")]),a._v(" 或 "),e("code",[a._v("MachOView")]),a._v(" 查看 "),e("code",[a._v("cryptid")]),a._v(" 的值，为 "),e("code",[a._v("0")]),a._v(" 即为脱壳成功。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191515813.png",alt:""}})]),a._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202202191515142.png",alt:""}})])])}),[],!1,null,null,null);e.default=r.exports}}]);