(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{492:function(t,a,s){"use strict";s.r(a);var n=s(15),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("iframe",{attrs:{src:"//player.bilibili.com/player.html?isOutside=true&aid=112903684425787&bvid=BV1yTiFeREGq&cid=500001638207205&p=1",scrolling:"no",border:"0",frameborder:"no",framespacing:"0",allowfullscreen:"true",width:"100%",height:"560px"}}),t._v(" "),a("h2",{attrs:{id:"一、概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、概述"}},[t._v("#")]),t._v(" 一、概述")]),t._v(" "),a("p",[t._v("距离 "),a("a",{attrs:{href:"https://github.com/LinXunFeng/flutter_chat_packages/tree/main/packages/chat_bottom_container",target:"_blank",rel:"noopener noreferrer"}},[t._v("chat_bottom_container"),a("OutboundLink")],1),t._v(" 首个可用版本 ("),a("code",[t._v("0.0.2")]),t._v(") 的发布已经过去了 "),a("code",[t._v("1")]),t._v(" 个多月，在这期间根据大家的使用反馈，我们也做了一些优化调整，今天就来盘点一下到底做了哪些优化，新增了什么功能，以及一些常见操作。")]),t._v(" "),a("p",[t._v("请注意")]),t._v(" "),a("ul",[a("li",[t._v("本篇仅介绍更新的优化及功能，基础使用请查看: "),a("RouterLink",{attrs:{to:"/pages/1af1e6/"}},[t._v("Flutter - 实现聊天键盘与功能面板的丝滑切换 🍻")])],1),t._v(" "),a("li",[t._v("截至本篇发布时，最新版本为 "),a("code",[t._v("0.2.0")]),t._v("，可以关注我们的微信公众号 "),a("a",{attrs:{href:"https://fastly.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/FSA_QR_bottom.png",target:"_blank",rel:"noopener noreferrer"}},[t._v("FSA全栈行动"),a("OutboundLink")],1),t._v("  获取最新的资讯")])]),t._v(" "),a("blockquote",[a("p",[t._v("开源不易，如果你也觉得这个库好用，请不吝给个 "),a("code",[t._v("Star")]),t._v(" 👍 ，并多多支持！")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/LinXunFeng/flutter_chat_packages",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/LinXunFeng/flutter_chat_packages"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"二、使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、使用"}},[t._v("#")]),t._v(" 二、使用")]),t._v(" "),a("h3",{attrs:{id:"调整键盘高度监听管理逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调整键盘高度监听管理逻辑"}},[t._v("#")]),t._v(" 调整键盘高度监听管理逻辑")]),t._v(" "),a("p",[a("code",[t._v("0.1.0")]),t._v(" 版本前，只考虑了页面栈这种常规情况，当键盘高度变化时只处理栈顶的监听。")]),t._v(" "),a("p",[t._v("但其实还有一种常见打破该规则的场景，就是悬浮聊天页，它会一直在页面上，可能为了能快速从悬浮小球展开聊天页面，收起时只是做了隐藏，而不会销毁页面，在这种情况下，它依旧在监听管理里的栈顶，所以在收起后，上一个聊天页的键盘高度监听就会失效。")]),t._v(" "),a("p",[t._v("这个在 "),a("code",[t._v("0.1.0")]),t._v(" 版本中得到修复，内部会倒序遍历调用所有的监听回调。")]),t._v(" "),a("p",[t._v("不过你不用担心这一改动会导致其它聊天页面出现多余的视图刷新，因为在键盘高度监听回调里会先判断输入框是否有焦点，若无则直接返回了。")]),t._v(" "),a("h3",{attrs:{id:"兼容外接键盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#兼容外接键盘"}},[t._v("#")]),t._v(" 兼容外接键盘")]),t._v(" "),a("p",[t._v("当连接外接键盘时，软键盘会消失，高度会降为 "),a("code",[t._v("0")]),t._v("，这里可以用 "),a("code",[t._v("iOS")]),t._v(" 模拟器结合 "),a("code",[t._v("Toggle Software Keyboard")]),t._v(" (快捷键: "),a("code",[t._v("cmd + k")]),t._v(") 来模拟连接与断开外接键盘的效果。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041319269.gif",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"隐藏面板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#隐藏面板"}},[t._v("#")]),t._v(" 隐藏面板")]),t._v(" "),a("p",[t._v("有小伙伴提出，不知道如何程序式的隐藏面板，其实很简单，就两步")]),t._v(" "),a("ol",[a("li",[t._v("让输入框失去焦点")]),t._v(" "),a("li",[t._v("更新内部状态为 "),a("code",[t._v("ChatBottomPanelType.none")])])]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hidePanel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.2.0 前")]),t._v("\n  inputFocusNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unfocus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("none "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentPanelType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updatePanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 0.2.0 后，可以这么写")]),t._v("\n  controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updatePanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    forceHandleFocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomHandleFocus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("unfocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"自定义底部安全区高度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义底部安全区高度"}},[t._v("#")]),t._v(" 自定义底部安全区高度")]),t._v(" "),a("p",[t._v("在默认情况下，"),a("code",[t._v("chat_bottom_container")]),t._v(" 在收起模式 ("),a("code",[t._v(".none")]),t._v(") 下会自动帮你添加底部安全区高度，但在一些场景下你可能不希望如此。比如：")]),t._v(" "),a("ul",[a("li",[t._v("安卓的底部安全区的高度，很多小伙伴都是简单粗暴的设置个高度了事")]),t._v(" "),a("li",[a("code",[t._v("App")]),t._v(" 首页有底部 "),a("code",[t._v("BottomNavigationBar")]),t._v("，不需要安全区高度")])]),t._v(" "),a("p",[t._v("在此，你可以通过将 "),a("code",[t._v("safeAreaBottom")]),t._v(" 参数来自定义这个高度，如下设置为 "),a("code",[t._v("0")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelContainer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  safeAreaBottom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"调整键盘面板高度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调整键盘面板高度"}},[t._v("#")]),t._v(" 调整键盘面板高度")]),t._v(" "),a("p",[t._v("如示例中位于首页的聊天页面")]),t._v(" "),a("img",{attrs:{height:"750",src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041319288.png"}}),t._v(" "),a("p",[t._v("在键盘弹出时，如下图所示")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("实际")]),t._v(" "),a("th",[t._v("期望")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041319353.png",alt:""}})]),t._v(" "),a("td",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041319990.png",alt:""}})])])])]),t._v(" "),a("p",[t._v("很明显，我们希望键盘容器高度能够减去外层底部固定的 "),a("code",[t._v("BottomNavigationBar")]),t._v(" 高度。")]),t._v(" "),a("p",[a("code",[t._v("ChatBottomPanelContainer")]),t._v(" 提供了 "),a("code",[t._v("changeKeyboardPanelHeight")]),t._v(" 回调，在回调中可以拿到当前的键盘高度，经过计算后，将合适的键盘容器高度返回即可。")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelContainer")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  changeKeyboardPanelHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keyboardHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" renderObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bottomNavigationBarKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentContext"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("findRenderObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("renderObj "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("is!")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RenderBox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" keyboardHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" keyboardHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" renderObj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"缓存键盘高度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存键盘高度"}},[t._v("#")]),t._v(" 缓存键盘高度")]),t._v(" "),a("p",[t._v("先来看未做键盘高度缓存处理之前，会发生什么？")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041320403.gif",alt:""}})]),t._v(" "),a("p",[t._v("上图一共进入了三次聊天页")]),t._v(" "),a("ul",[a("li",[t._v("第一次是先点击键盘，再切到表情面板，体验起来还是挺不错的。")]),t._v(" "),a("li",[t._v("为了避免一闪而过，没有注意到，所以第二次和第三次的操作是一样的，先唤起表情面板，再切到键盘，可以看到在切到键盘时会抖动。")])]),t._v(" "),a("p",[t._v("这是因为每次进入聊天页，键盘的高度为初始值 "),a("code",[t._v("0")]),t._v("，在 "),a("code",[t._v("0.2.0")]),t._v(" 版本中对此进行了优化，加入了键盘高度缓存逻辑，从而尽量避免该抖动问题的出现。")]),t._v(" "),a("blockquote",[a("p",[t._v("❗️ 但需要注意的是，假如你卸载重装 "),a("code",[t._v("App")]),t._v("，该缓存会丢失，即你还是有可能会看到最多一次的抖动。")])]),t._v(" "),a("p",[t._v("除此之外，你还可以使用这个缓存的键盘高度来实现表情面板与键盘高度保持一致的效果，这样在切换的时候体验上会更好些。😉")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Widget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_buildEmojiPickerPanel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果键盘高度还没有缓存过，则使用默认高度 300")]),t._v("\n  double height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" keyboardHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyboardHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("keyboardHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    height "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" keyboardHeight"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Container")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    padding"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EdgeInsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zero"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" height"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    color"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Colors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("blue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Center")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Emoji Panel'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("效果如下")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20230813121546/image/202408041320246.gif",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"支持表情面板与输入框焦点共存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持表情面板与输入框焦点共存"}},[t._v("#")]),t._v(" 支持表情面板与输入框焦点共存")]),t._v(" "),a("p",[t._v("这也是提升用户体验的重要一点，效果见上图。")]),t._v(" "),a("p",[t._v("先按如下设置你的输入框")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[t._v("bool readOnly "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextEditingController")]),t._v(" textEditingController "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextEditingController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TextField")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" textEditingController"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  focusNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" inputFocusNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为 true 时不显示键盘，默认为 false")]),t._v("\n  readOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" readOnly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取焦点后显示光标，设置为 true 才不受 readOnly 的影响")]),t._v("\n  showCursor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("接下来就是切换表情面板的操作")]),t._v(" "),a("div",{staticClass:"language-dart extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dart"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("switchToEmojiPanel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  readOnly "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里你可以只刷新输入框")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等待下一帧")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WidgetsBinding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addPostFrameCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeStamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    controller"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("updatePanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 内部切至 other 状态")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomPanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("other"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关联外部的面板类型为表情面板")]),t._v("\n      data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PanelType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("emoji"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 输入框获取焦点")]),t._v("\n      forceHandleFocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ChatBottomHandleFocus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestFocus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在 "),a("code",[t._v("updatePanelType")]),t._v(" 方法中，如果是切至 "),a("code",[t._v(".other")]),t._v(" 状态，是会帮你执行失去焦点操作的，所以这里提供了一个 "),a("code",[t._v("forceHandleFocus")]),t._v(" 参数，如果你对方法内部对焦点的处理不满意，你可以使用它来强制指定焦点的处理方式。")]),t._v(" "),a("h2",{attrs:{id:"三、最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、最后"}},[t._v("#")]),t._v(" 三、最后")]),t._v(" "),a("p",[t._v("好了，上述便是该库的更新内容, 惯例附上 "),a("code",[t._v("GitHub")]),t._v(" 地址: "),a("a",{attrs:{href:"https://github.com/LinXunFeng/flutter_chat_packages/tree/main/packages/chat_bottom_container",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/LinXunFeng/flutter_chat_packages/tree/main/packages/chat_bottom_container"),a("OutboundLink")],1),t._v(" ，如果接入上有什么问题，可以在链接中查看 "),a("code",[t._v("demo")]),t._v(" 演示代码。")]),t._v(" "),a("p",[t._v("开源不易，如果你也觉得这个库好用，请不吝给个 "),a("code",[t._v("Star")]),t._v(" 👍 ，并多多支持！")]),t._v(" "),a("p",[t._v("本篇到此结束，感谢大家的支持，我们下次再见！ 👋")])])}),[],!1,null,null,null);a.default=e.exports}}]);