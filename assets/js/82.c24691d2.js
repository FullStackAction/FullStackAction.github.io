(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{428:function(t,s,a){"use strict";a.r(s);var n=a(15),p=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、背景"}},[t._v("#")]),t._v(" 一、背景")]),t._v(" "),s("p",[t._v("在日常研发中，被提 "),s("code",[t._v("bug")]),t._v(" 是家常便饭，当 "),s("code",[t._v("bug")]),t._v(" 修复完成后便提交代码，然后触发构建机打出测试包，自动上传至蒲公英后提供测试，但是我们的构建机打一个包的时间近 "),s("code",[t._v("25分钟")]),t._v("，而且有时还会莫名其妙的出现失败，效率偏低。那什么办法减少这个时间呢？")]),t._v(" "),s("p",[t._v("经过下面的方案调整后，我将时间测试包的出包时间降低至 "),s("code",[t._v("20秒")]),t._v(" 左右，极速出包 😃")]),t._v(" "),s("h2",{attrs:{id:"二、思考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、思考"}},[t._v("#")]),t._v(" 二、思考")]),t._v(" "),s("p",[t._v("我们在编译运行时，"),s("code",[t._v("xcode")]),t._v(" 就已经打出了后缀为 "),s("code",[t._v("app")]),t._v(" 的包，并且是经过描述文件签名的，所以可安装于那些 "),s("code",[t._v("UDID")]),t._v(" 有记录于描述文件中的测试机，该 "),s("code",[t._v("app")]),t._v(" 包存放于 "),s("code",[t._v("DerivedData")]),t._v("，其具体路径如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/Users/lxf/Library/Developer/Xcode/DerivedData/LXFCardsLayout-xxx/Build/Products/Debug-iphoneos/LXFCardsLayout.app\n")])])]),s("p",[t._v("所以这从这里开始，我们需要思考的是如何得到该 "),s("code",[t._v("app")]),t._v(" 包的路径，以及拿到 "),s("code",[t._v("app")]),t._v(" 包后要如何处理才能安装到测试机")]),t._v(" "),s("h2",{attrs:{id:"三、解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、解决方案"}},[t._v("#")]),t._v(" 三、解决方案")]),t._v(" "),s("h3",{attrs:{id:"_1、app-转-ipa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、app-转-ipa"}},[t._v("#")]),t._v(" 1、"),s("code",[t._v("app")]),t._v(" 转 "),s("code",[t._v("ipa")])]),t._v(" "),s("p",[t._v("上面提到的两个问题中，第二个很好处理，我们只要新建一个名为 "),s("code",[t._v("Payload")]),t._v(" 的文件夹，将 "),s("code",[t._v("LXFCardsLayout.app")]),t._v(" 放入其中，接着进行 "),s("code",[t._v("zip")]),t._v(" 压缩，将 "),s("code",[t._v("zip")]),t._v(" 后缀改成 "),s("code",[t._v("ipa")]),t._v(" 即可。")]),t._v(" "),s("p",[t._v("这里需要注意的是：该 "),s("code",[t._v("app")]),t._v(" 包是根据当前真机的架构打包而来，像我们的测试机是 "),s("code",[t._v("arm64")]),t._v(" 架构的，所以打出来的是仅包含 "),s("code",[t._v("arm64")]),t._v(" 架构，"),s("code",[t._v("armv7")]),t._v(" 的设备就不可使用，但我们的测试机都是 "),s("code",[t._v("arm64")]),t._v(" 架构的，所以问题不大。在使用的过程中大家请注意自己的设备架构～")]),t._v(" "),s("h3",{attrs:{id:"_2、获取-app-包路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、获取-app-包路径"}},[t._v("#")]),t._v(" 2、获取 "),s("code",[t._v("app")]),t._v(" 包路径")]),t._v(" "),s("p",[t._v("在编译的过程中，有一个环境变量 "),s("code",[t._v("BUILD_DIR")]),t._v("，可以取到如下路径")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/Users/lxf/Library/Developer/Xcode/DerivedData/LXFCardsLayout-xxx/Build/Products\n")])])]),s("p",[t._v("不过在 "),s("code",[t._v("Archive")]),t._v("的时候，得到的路径如下：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("/Users/lxf/Library/Developer/Xcode/DerivedData/LXFCardsLayout-xxx/Build/Intermediates.noindex/ArchiveIntermediates/LXFCardsLayout-Swift/BuildProductsPath\n")])])]),s("p",[t._v("在 "),s("code",[t._v("shell")]),t._v(" 环境中，我们可以使用 "),s("code",[t._v("%")]),t._v(" 取到 "),s("code",[t._v("LXFCardsLayout-xxx")]),t._v("为至的路径，即把 "),s("code",[t._v("Build/")]),t._v("及后边的内容全部删掉")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${BUILD_DIR"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("Build"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("*}")]),t._v("\n")])])]),s("h2",{attrs:{id:"四、实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、实践"}},[t._v("#")]),t._v(" 四、实践")]),t._v(" "),s("h3",{attrs:{id:"_1、保存-app-路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、保存-app-路径"}},[t._v("#")]),t._v(" 1、保存 "),s("code",[t._v("app")]),t._v(" 路径")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("iOS")]),t._v(" 项目下新建一个 "),s("code",[t._v("script")]),t._v(" 目录，存放 "),s("code",[t._v("python")]),t._v(" 脚本 "),s("code",[t._v("save_build_config.py")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: UTF-8 -*-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- author: LinXunFeng -*-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" configparser "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ConfigParser\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle_build_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""保存编译时的一些配置"""')]),t._v("\n    build_dir_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BUILD_DIR"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译地址")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" build_dir_path "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    \n    build_str_index "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" build_str_index "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        build_dir_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("build_str_index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    save_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build_dir_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("save_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    保存配置\n    :param key: 键\n    :param value: 值\n    :return:\n    """')]),t._v("\n    section_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'project'")]),t._v("\n    config_file_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build_time_conf.ini'")]),t._v("\n    config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ConfigParser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_file_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("has_section"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("section_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_section"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("section_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("section_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_file_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'w'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    handle_build_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202201260006052.png",alt:""}})]),t._v(" "),s("p",[t._v("注：脚本中的 "),s("code",[t._v("section_name = 'project'")]),t._v("，可以调整成其它名称，如：项目名，但需要与下文另一脚本中的 "),s("code",[t._v("section_name")]),t._v(" 保持一致！")]),t._v(" "),s("p",[t._v("新建 "),s("code",[t._v("Run Script")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202201260005616.png",alt:""}})]),t._v(" "),s("p",[t._v("填写如下内容")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# LinXunFeng 项目其它配置")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" script\npython3 save_build_config.py "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记录编译时配置")]),t._v("\n")])])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202201260007777.png",alt:""}})]),t._v(" "),s("p",[t._v("该操作的用意：在编译的过程中，将 "),s("code",[t._v("app")]),t._v(" 包所在路径保持至 "),s("code",[t._v("script")]),t._v(" 目录的 "),s("code",[t._v("build_time_conf.ini")]),t._v(" 文件中，并使用 "),s("code",[t._v("build_dir_path")]),t._v(" 做为其 "),s("code",[t._v("key")]),t._v("。")]),t._v(" "),s("p",[t._v("注：鉴于多人协作下，该 "),s("code",[t._v("build_time_conf.ini")]),t._v(" 文件必定不可能相同，所以建议将该 "),s("code",[t._v("build_time_conf.ini")]),t._v(" 文件添加至 "),s("code",[t._v(".gitignore")]),t._v(" 中")]),t._v(" "),s("h3",{attrs:{id:"_2、处理-app-包并上传至蒲公英"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、处理-app-包并上传至蒲公英"}},[t._v("#")]),t._v(" 2、处理 "),s("code",[t._v("app")]),t._v(" 包并上传至蒲公英")]),t._v(" "),s("p",[s("code",[t._v("push_dev_ipa.py")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- coding: utf-8 -*-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -*- author: LinXunFeng -*-")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" utils "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" file_util "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" FileUtil\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" utils "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" upload_pgyer "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" PgyerUtil\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" configparser "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ConfigParser\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" enum "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Enum\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppackSetKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Enum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""appack_set的键"""')]),t._v("\n    PGYER_API_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pgyer_api_key"')]),t._v("\n    PGYER_USER_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pgyer_user_key"')]),t._v("\n    PGYER_PASSWORD_KEY "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pgyer_api_password"')]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_build_dir_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_ini_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""获取项目的编译目录路径"""')]),t._v("\n    section_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'project'")]),t._v("\n    config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ConfigParser"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_ini_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("has_section"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("section_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("section_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build_dir_path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_build_config_ini_path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""获取build_conf.ini文件路径"""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build_time_conf.ini'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_pgyer_config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""获取蒲公英的相关配置"""')]),t._v("\n    config_set_json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fastlane'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'appack_set.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    json_data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FileUtil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_set_json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print(json_data)")]),t._v("\n    pgyer_api_key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AppackSetKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PGYER_API_KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    pgyer_user_key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AppackSetKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PGYER_USER_KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    pgyer_password "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("AppackSetKey"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PGYER_PASSWORD_KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" pgyer_api_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_user_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_password\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    app_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" target_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.app'")]),t._v("\n\n    config_ini_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_build_config_ini_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    build_dir_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config_ini_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build_dir_path -- '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    app_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("build_dir_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build/Products/Debug-iphoneos'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print(app_path)")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cur_path = os.path.abspath('.')")]),t._v("\n    script_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    temp_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'temp'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    payload_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Payload'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    payload_app_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rmtree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 移除Payload")]),t._v("\n        time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 等删除完")]),t._v("\n    os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("makedirs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建Payload")]),t._v("\n    new_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copytree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("app_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload_app_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print(new_path)")]),t._v("\n    ipa_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("make_archive"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zip'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ipa_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("move"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ipa_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.ipa'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ipa_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上传至蒲公英")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("payer_upload_callback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        shutil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rmtree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("temp_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除temp目录")]),t._v("\n\n    pgyer_api_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_user_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_password "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_pgyer_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    PgyerUtil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("upload_to_pgyer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ipa_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_api_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pgyer_user_key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pgyer_password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callbcak"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("payer_upload_callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    argv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    project_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 项目路径")]),t._v("\n    target_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# target名称")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p:t:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"target_name="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" getopt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetoptError"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'push_dev_ipa.py -p "项目路径" -t "target名"\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arg "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" opts"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" opt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-p"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            project_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" arg\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请输入项目的地址'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                sys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请输入项目的地址'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" opt "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-t"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--target_name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            target_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" arg\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# print(project_path)")]),t._v("\n    handle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" target_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("配置说明：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("config_set_json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("project_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fastlane'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'appack_set.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("我们项目中与蒲公英配置相关的内容存入于 "),s("code",[t._v("项目/fastlane/appack_set.json")]),t._v("，可以根据自身实际情况进行调整")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ...\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pgyer_api_key"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_key_xxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pgyer_user_key"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user_key_xxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pgyer_api_password"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_password_xxx"')]),t._v("\n  ...\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在使用该脚本前请根据 "),s("RouterLink",{attrs:{to:"/pages/f2ddfa/"}},[t._v("【Mac上pyenv的安装与使用】")]),t._v(" 配置虚拟环境 "),s("code",[t._v("env383_ScriptBox")]),t._v("，完成后激活该虚拟环境，按如下命令安装依赖包")],1),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("pip "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" requirements.txt\n")])])]),s("p",[t._v("使用：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("python push_dev_ipa.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"项目路径"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"target名"')]),t._v("\n")])])]),s("h2",{attrs:{id:"五、实现一键"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、实现一键"}},[t._v("#")]),t._v(" 五、实现一键")]),t._v(" "),s("p",[t._v("使用 "),s("a",{attrs:{href:"http://fitztrev.github.io/shuttle/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Shuttle"),s("OutboundLink")],1),t._v(" 将该命令保存起来，实现在编译完成后，一键打包上传至蒲公英")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202201260008568.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"更新测试包"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cmd"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"cd /Users/lxf/Desktop/github/script_box; python push_dev_ipa.py -p '/Users/lxf/Desktop/github/LXFCardsLayout/'\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"inTerminal"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"new"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上传测试包至蒲公英"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"上传测试包至蒲公英"')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("此处说明一下 "),s("code",[t._v("cd")]),t._v(" 命令的用意：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /Users/lxf/Desktop/github/script_box\n")])])]),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202201260008665.png",alt:""}})]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("script_box")]),t._v(" 下存有一个名为 "),s("code",[t._v(".python-version")]),t._v(" 的文件，里面仅写了 "),s("code",[t._v("env383_ScriptBox")]),t._v("，这是一个 "),s("code",[t._v("python")]),t._v(" 虚拟环境，其作用是：当进入包含该文件所在目录时，会自动切换至该 "),s("code",[t._v("python")]),t._v(" 虚拟环境。")]),t._v(" "),s("p",[t._v("我使用的是 "),s("code",[t._v("pyenv")]),t._v(" 来实现 "),s("code",[t._v("python")]),t._v(" 虚拟环境，详细说明可以看我的另一篇文章："),s("RouterLink",{attrs:{to:"/pages/f2ddfa/"}},[t._v("【Mac上pyenv的安装与使用】")])],1),t._v(" "),s("h2",{attrs:{id:"六、其它"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、其它"}},[t._v("#")]),t._v(" 六、其它")]),t._v(" "),s("p",[s("code",[t._v("Shuttle")]),t._v(" 虽然好用，但是在后续使用过程中，你一定会遇到多处配置相同的情况，如果你想解决该问题，不妨看我的解决方案："),s("RouterLink",{attrs:{to:"/pages/f6869d/"}},[t._v("【Jsonnet - json数据模板语言】")])],1),t._v(" "),s("p",[t._v("脚本链接："),s("a",{attrs:{href:"https://github.com/LinXunFeng/script_box",target:"_blank",rel:"noopener noreferrer"}},[t._v("LinXunFeng/script_box: 脚本工具箱 (github.com)"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=p.exports}}]);