(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{591:function(e,t,o){"use strict";o.r(t);var r=o(21),_=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("系列文章：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/6AFd-4hyJQ6N7AVuJW4WIw",target:"_blank",rel:"noopener noreferrer"}},[e._v("《AI - stable-diffusion(AI 绘画)的搭建与使用》"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/-POx-c_fcMTtYU-6dWOaVg",target:"_blank",rel:"noopener noreferrer"}},[e._v("《AI - AI 绘画的精准控图(ControlNet)》"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/GvyOC101H3sALNtB67No4w",target:"_blank",rel:"noopener noreferrer"}},[e._v("《AI - stable-diffusion 艺术化二维码》"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"一、介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、介绍"}},[e._v("#")]),e._v(" 一、介绍")]),e._v(" "),t("p",[e._v("在上一篇\n"),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg4MTA4MDQzMQ==&mid=2247485165&idx=1&sn=26a3c6641152d122b700a19f6083e2c0&chksm=cf6a27edf81daefb6279de2cb8ce77de9e66753f5ed435d2c21fdd351449d8f4b9775ba246b2&token=459750899&lang=zh_CN#rd",target:"_blank",rel:"noopener noreferrer"}},[e._v("《AI - stable-diffusion(AI 绘画)的搭建与使用》"),t("OutboundLink")],1),e._v(" 中， 介绍了 "),t("code",[e._v("SD")]),e._v(" 的环境搭建与使用，搭配各种特色模型文件，"),t("code",[e._v("SD")]),e._v(" 的文生图功能就可以根据我们输入的提示词（Prompt），绘制出各种各样的精美图片。但是，在深度使用之后你会发现，想让 AI 绘制出自己满意的图片并不容易，甚至多次调整提示词（Prompt）也生成不出来我们想要的画面。")]),e._v(" "),t("blockquote",[t("p",[e._v("注：后续文中提到的 "),t("code",[e._v("SD")]),e._v(" 代指 "),t("code",[e._v("stable-diffusion")]),e._v(" 或 "),t("code",[e._v("stable-diffusion-webui")]),e._v("。")])]),e._v(" "),t("p",[e._v("这时你需要一个大杀器 "),t("code",[e._v("ControlNet")]),e._v("，"),t("code",[e._v("SD")]),e._v(" 搭配上 "),t("code",[e._v("ControlNet")]),e._v(" 之后，就可以做到精准控图了，先来看看几个 "),t("code",[e._v("ControlNet")]),e._v(" 能做到的效果：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303080015526.png",alt:""}})]),e._v(" "),t("ul",[t("li",[e._v("ControlNet 官方仓库："),t("a",{attrs:{href:"https://github.com/lllyasviel/ControlNet",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/lllyasviel/ControlNet"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"二、安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、安装"}},[e._v("#")]),e._v(" 二、安装")]),e._v(" "),t("p",[e._v("跟 "),t("code",[e._v("SD")]),e._v(" 一样，"),t("code",[e._v("ControlNet")]),e._v(" 官方仓库不适合新手直接使用，我们可以安装 "),t("code",[e._v("stable-diffusion-webui")]),e._v(" 的一个插件（"),t("code",[e._v("sd-webui-controlnet")]),e._v("）来使用 "),t("code",[e._v("ControlNet")]),e._v("，这是插件的 github 地址：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/Mikubill/sd-webui-controlnet",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/Mikubill/sd-webui-controlnet"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"_1、安装插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装插件"}},[e._v("#")]),e._v(" 1、安装插件")]),e._v(" "),t("p",[e._v("安装这个插件很简单，在 "),t("code",[e._v("webui")]),e._v(" 页面上找到 "),t("code",[e._v("Extensions")]),e._v(" -> "),t("code",[e._v("Install from URL")]),e._v("，输入插件的 git 地址 "),t("code",[e._v("https://github.com/Mikubill/sd-webui-controlnet.git")]),e._v("，点击 "),t("code",[e._v("Install")]),e._v(" 即可：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011507992.png",alt:""}})]),e._v(" "),t("p",[e._v("等待 loading 结束后，页面底部会出现 "),t("code",[e._v("Installed into xxx. Use Installed tab to restart.")]),e._v(" 提示，这时再依次找到 "),t("code",[e._v("Extensions")]),e._v(" -> "),t("code",[e._v("Installed")]),e._v(" -> "),t("code",[e._v("Apply and restart UI")]),e._v(" 重启 "),t("code",[e._v("webui")]),e._v("：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011513558.png",alt:""}})]),e._v(" "),t("p",[e._v("重启完成后，就可以在 "),t("code",[e._v("txt2img")]),e._v(" 和 "),t("code",[e._v("img2img")]),e._v(" 中看到会多出来一个 "),t("code",[e._v("ControlNet")]),e._v(" 选项，这样插件就安装完成了：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011527669.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_2、安装模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装模型"}},[e._v("#")]),e._v(" 2、安装模型")]),e._v(" "),t("p",[t("code",[e._v("sd-webui-controlnet")]),e._v(" 插件安装完成之后，还需要配置一下 "),t("code",[e._v("ControlNet")]),e._v(" 的专属模型（注意：不要跟 "),t("code",[e._v("SD")]),e._v(" 的模型搞混了）。在此之前，先来了解一下 "),t("code",[e._v("ControlNet")]),e._v(" 的绘画流程：")]),e._v(" "),t("ol",[t("li",[e._v("用户提供一张参考图，"),t("code",[e._v("ControlNet")]),e._v(" 根据指定的模式对参考图进行预处理，得到一张新图，作为另一张参考图。")]),e._v(" "),t("li",[e._v("根据提示词（Prompt），结合前面的（1 张 或 2 张）参考图，进行图像绘制。")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011609455.png",alt:""}})]),e._v(" "),t("p",[e._v("上述流程的两个阶段，对应用到的模型有两种，以下是它们的下载地址：")]),e._v(" "),t("ol",[t("li",[e._v("预处理器模型（"),t("code",[e._v("annotator")]),e._v("）："),t("a",{attrs:{href:"https://huggingface.co/lllyasviel/ControlNet/tree/main/annotator/ckpts",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://huggingface.co/lllyasviel/ControlNet/tree/main/annotator/ckpts"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("预训练模型（"),t("code",[e._v("models")]),e._v("）："),t("a",{attrs:{href:"https://huggingface.co/lllyasviel/ControlNet/tree/main/models",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://huggingface.co/lllyasviel/ControlNet/tree/main/models"),t("OutboundLink")],1)])]),e._v(" "),t("blockquote",[t("p",[e._v("注：预训练模型（裁剪过的 "),t("code",[e._v("models")]),e._v("）："),t("a",{attrs:{href:"https://huggingface.co/webui/ControlNet-modules-safetensors/tree/main",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://huggingface.co/webui/ControlNet-modules-safetensors/tree/main"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("打开预处理器模型（"),t("code",[e._v("annotator")]),e._v("）网址，将需要用到的模型下载下来后，保存到插件的 "),t("code",[e._v("annotator")]),e._v(" 目录下：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011625191.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注意：预处理器模型需按分类目录存放，例如 "),t("code",[e._v("body_pose_model.pth")]),e._v(" 和 "),t("code",[e._v("hand_pose_model.pth")]),e._v(" 应保存到 "),t("code",[e._v("openpose")]),e._v(" 目录；而 "),t("code",[e._v("upernet_global_small.pth")]),e._v(" 则是保存到 "),t("code",[e._v("uniformer")]),e._v(" 目录；其他模型文件可根据关键字，找到对应存放目录。")]),e._v(" "),t("p",[e._v("插件的 "),t("code",[e._v("annotator")]),e._v(" 目录："),t("code",[e._v("stable-diffusion-webui\\extensions\\sd-webui-controlnet\\annotator")]),e._v("。")])]),e._v(" "),t("p",[e._v("打开预训练模型（"),t("code",[e._v("models")]),e._v("）网址，将需要用到的模型下载下来后，保存到插件的 "),t("code",[e._v("models")]),e._v(" 目录下：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011625055.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注意：这步别急着动手，下面有体积更小的模型。⚠️⚠️⚠️")]),e._v(" "),t("p",[e._v("插件的 "),t("code",[e._v("models")]),e._v(" 目录："),t("code",[e._v("stable-diffusion-webui\\extensions\\sd-webui-controlnet\\models")]),e._v("。")])]),e._v(" "),t("p",[t("code",[e._v("ControlNet")]),e._v(" 官方存放在 "),t("code",[e._v("huggingface")]),e._v(" 上的预训练模型文件一个个都是 5 个 G 起步，这是因为它们内部都包含了 "),t("code",[e._v("SD")]),e._v(" 那个将近 4 个 G 的 "),t("code",[e._v("v1-5-pruned-emaonly")]),e._v(" 模型，这在 "),t("code",[e._v("stable-diffusion-webui")]),e._v(" 环境下是没必要的，这时我们可以使用专门裁剪过的预训练模型文件，体积会少很多：")]),e._v(" "),t("ul",[t("li",[e._v("预训练模型（裁剪过的 "),t("code",[e._v("models")]),e._v("）："),t("a",{attrs:{href:"https://huggingface.co/webui/ControlNet-modules-safetensors/tree/main",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://huggingface.co/webui/ControlNet-modules-safetensors/tree/main"),t("OutboundLink")],1)])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303011647158.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：一般把所有 "),t("code",[e._v("control_xxx.safetensors")]),e._v(" 文件下载下来保存到本地 models 目录下即可，如果你觉得模型文件太多，磁盘空间占用太大，也可以按需下载。")])]),e._v(" "),t("h2",{attrs:{id:"三、使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、使用"}},[e._v("#")]),e._v(" 三、使用")]),e._v(" "),t("p",[t("code",[e._v("sd-webui-controlnet")]),e._v(" 插件和模型文件（预处理器模型、预训练模型）都安装完成之后，再重启一次 "),t("code",[e._v("webui")]),e._v(" 就可以正常使用 "),t("code",[e._v("ControlNet")]),e._v(" 功能了。")]),e._v(" "),t("h3",{attrs:{id:"_1、人体姿势-human-pose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、人体姿势-human-pose"}},[e._v("#")]),e._v(" 1、人体姿势（"),t("code",[e._v("Human Pose")]),e._v("）")]),e._v(" "),t("p",[e._v("根据 "),t("code",[e._v("civitai")]),e._v(" 网站上的 "),t("code",[e._v("Deliberate")]),e._v(" 模型案例，生成一张牛奶工的图片：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303022204701.png",alt:""}})]),e._v(" "),t("p",[e._v("现在我们希望 AI 绘制出来的牛奶工他是坐着的，这时，就可以用上 "),t("code",[e._v("ControlNet")]),e._v(" 选项了。展开 "),t("code",[e._v("ControlNet")]),e._v(" 选项之后，把 "),t("code",[e._v("Enable")]),e._v(" 勾上使其生效，之后，指定 "),t("code",[e._v("openpose")]),e._v(" 所需的预处理器模型（Preprocessor）和预训练库模型（Model）：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303022211160.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：如果你使用的是 8G 以下显存（或者想获取更大的批量大小），可以把 "),t("code",[e._v("Low VRAM")]),e._v(" 勾上。\n"),t("a",{attrs:{href:"https://github.com/lllyasviel/ControlNet/blob/main/docs/low_vram.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/lllyasviel/ControlNet/blob/main/docs/low_vram.md"),t("OutboundLink")],1)])]),e._v(" "),t("p",[t("code",[e._v("ControlNet")]),e._v(' 选项配置完成后，其它保持不变，点击 "Generate" 按钮重新生成，这时绘制出来的牛奶工的姿势就跟我们提供的参考图基本一致了：')]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303022211844.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：图中牛奶工的小腿摆向与骨架图中的小腿摆向不符，不过整体效果已经很不错了，相信后续 "),t("code",[e._v("ControlNet")]),e._v(" 能优化好这一点。")])]),e._v(" "),t("p",[e._v("你也可以看到，"),t("code",[e._v("SD")]),e._v(" 同时还生成出了一张骨架图，这骨架图是在 "),t("code",[e._v("ControlNet")]),e._v(" 的预处理阶段生成的。而且 "),t("code",[e._v("openpose")]),e._v(' 主要依据的参考图就是这张骨架图，也就是说，当我们手上有现成的骨架图时，完全可以直接将骨架图作为参考图，跳过预处理阶段（设为 "none"），直接进入绘图阶段。有兴趣的可以动手试试，效果是一样的：')]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303022224604.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_2、重新着色和风格化-canny-edge、hed-boundary"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、重新着色和风格化-canny-edge、hed-boundary"}},[e._v("#")]),e._v(" 2、重新着色和风格化（"),t("code",[e._v("Canny Edge")]),e._v("、"),t("code",[e._v("HED Boundary")]),e._v("）")]),e._v(" "),t("p",[e._v("如果你希望对现有的图片重新着色或换一种风格，可以使用 "),t("code",[e._v("ControlNet")]),e._v(" 以下两个模型，它们的主要区别是边缘检测算法不同：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Canny Edge")]),e._v(" 模型：采用 Canny 边缘检测算法")]),e._v(" "),t("li",[t("code",[e._v("HED Boundary")]),e._v(" 模型：采用 HED(Holistically-Nested Network) 边缘检测算法")])]),e._v(" "),t("p",[e._v("下面我们就分别采用这两种模型来试试，这是 "),t("code",[e._v("Canny Edge")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041517731.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041519509.png",alt:""}})]),e._v(" "),t("p",[e._v("这是 "),t("code",[e._v("HED Boundary")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041520204.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041520651.png",alt:""}})]),e._v(" "),t("p",[e._v("可以直观看到，两种模型生成的 "),t("code",[e._v("边缘检测图")]),e._v(" 不同，从而最终绘制出来的图片细节上也有差别（注意看小女孩头发上的 3 个反光点），至于哪个更好，看个人感觉吧，我觉得 "),t("code",[e._v("HED Boundary")]),e._v(" 模型好一点。关于这两种边缘检测算法的说明，可以查看以下文章了解：")]),e._v(" "),t("ul",[t("li",[e._v("边缘检测的三种算法介绍："),t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/35694372",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://zhuanlan.zhihu.com/p/35694372"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("边缘检测之 HED："),t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/43600043",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://zhuanlan.zhihu.com/p/43600043"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"_3、草图绘制-scribbles"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、草图绘制-scribbles"}},[e._v("#")]),e._v(" 3、草图绘制（"),t("code",[e._v("Scribbles")]),e._v("）")]),e._v(" "),t("p",[e._v("使用 "),t("code",[e._v("Scribbles")]),e._v(" 模型，可以根据草图（涂鸦）绘制出精美的图片，对于那些没有学过美术或者没有绘画天赋的人来说，简直太棒了。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041542274.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("提示词（Prompt）：hot air balloon")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041543549.png",alt:""}})]),e._v(" "),t("p",[e._v("如果你懒得自己画草图，也可以将一张现成的作品交给 "),t("code",[e._v("ControlNet")]),e._v("，由它帮你画，注意，此时的预处理器模型换成了 "),t("code",[e._v("fake_scribble")]),e._v("（从成品图中提取出草图），而预训练模型还是 "),t("code",[e._v("control_scribble-fp16")]),e._v("（根据草图绘制作品）：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303062238199.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：这里是我唯一一处勾选了 "),t("code",[e._v("Low VRAM")]),e._v(" 的地方，因为在进行提取草图的预处理阶段，控制台报了显存不足的错误，此时草图也就没能提取成功，勾选 "),t("code",[e._v("Low VRAM")]),e._v(" 之后，一切就正常了。")])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303062239962.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_4、建筑物绘制-m-lsd-lines"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、建筑物绘制-m-lsd-lines"}},[e._v("#")]),e._v(" 4、建筑物绘制（"),t("code",[e._v("M-LSD Lines")]),e._v("）")]),e._v(" "),t("p",[e._v("如果你希望是对建筑物进行重新上色和风格化，可以使用 "),t("code",[e._v("M-LSD")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041553510.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041553851.png",alt:""}})]),e._v(" "),t("h3",{attrs:{id:"_5、语义分割绘制-semantic-segmentation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、语义分割绘制-semantic-segmentation"}},[e._v("#")]),e._v(" 5、语义分割绘制（"),t("code",[e._v("Semantic Segmentation")]),e._v("）")]),e._v(" "),t("p",[t("code",[e._v("Semantic Segmentation")]),e._v(" 语义分割是一种深度学习算法，重点关注 "),t("code",[e._v("语义")]),e._v(" 一词，这种算法将一个标签或类别与图像联系起来，被用来识别形成不同类别的像素集合。这么说有点抽象，我们先直接使用这个模型，看会生成出什么东西：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303062228795.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041728742.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注意：如果语义分割图没有生成出来，请查看控制台是否有报错，另外，检查一下 "),t("code",[e._v("upernet_global_small.pth")]),e._v(" 是否有保存到 "),t("code",[e._v("extensions\\sd-webui-controlnet\\annotator\\uniformer")]),e._v(" 目录。因为 "),t("code",[e._v("SD")]),e._v(" 自己也有一个 "),t("code",[e._v("models\\uniformer")]),e._v(" 目录，如果你前面没有手动放置好 "),t("code",[e._v("upernet_global_small.pth")]),e._v(" 模型文件，那么在用到 "),t("code",[e._v("Semantic Segmentation")]),e._v(" 模型时，"),t("code",[e._v("SD")]),e._v(" 会自动帮你下载一个到它自己的 "),t("code",[e._v("models\\uniformer")]),e._v(" 目录，这是个大坑，不过还好，这种情况控制台会报错，可以排查到这个问题。")])]),e._v(" "),t("p",[e._v("可以看到，预处理阶段生成了一张花花绿绿的图片，这就是语义分割图，这图中的每一种颜色都代表了一类物品，比如紫色（#cc05ff）代表床（bed），橙黄色（#ffc207）代表垫子（cushion），金黄色（#e0ff08）代表台灯（lamp）， "),t("code",[e._v("ControlNet")]),e._v(" 的 "),t("code",[e._v("Semantic Segmentation")]),e._v(" 模型使用的是 "),t("code",[e._v("ADE20K")]),e._v(" 协议，这些颜色值都可以在下面网址中找到对应的含义：")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.google.com/spreadsheets/d/1se8YEtb2detS7OuPE86fXGyD269pMycAWe2mtKUj2W8/edit#gid=0",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.google.com/spreadsheets/d/1se8YEtb2detS7OuPE86fXGyD269pMycAWe2mtKUj2W8/edit#gid=0"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://www.researchgate.net/figure/Semantic-labels-of-ADE20K-data-set-in-BGR-format_fig2_339839515",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://www.researchgate.net/figure/Semantic-labels-of-ADE20K-data-set-in-BGR-format_fig2_339839515"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/CSAILVision/sceneparsing/tree/master/visualizationCode/color150",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/CSAILVision/sceneparsing/tree/master/visualizationCode/color150"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("既然如此，那我们可以反向操作，修改某个物品的颜色，替换最终生成出来的图中的某样物品，比如把台灯（#e0ff08）换成花（#ff0000）：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041739016.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：跟 "),t("code",[e._v("openpose")]),e._v(' 直接提供骨架图一样，这里我们直接提供了语义分割图，所以预处理器选择 "none"。另外，注意此处我固定了 Seed 的值，这样最终生成出来的图片能跟上面的例子保持基本一致。')])]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303041739108.png",alt:""}})]),e._v(" "),t("p",[e._v("可以看到，最终绘制出来的图中，床边的台灯被替换成了花。")]),e._v(" "),t("h3",{attrs:{id:"_6、三维制图-depth、normal-map"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、三维制图-depth、normal-map"}},[e._v("#")]),e._v(" 6、三维制图（"),t("code",[e._v("Depth")]),e._v("、"),t("code",[e._v("Normal Map")]),e._v("）")]),e._v(" "),t("p",[e._v("如果你希望能对图中 3D 物体比较细致的把控，可以使用 "),t("code",[e._v("ControlNet")]),e._v(" 提供的以下 2 种模型：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Depth")]),e._v(" 模型：从原图中提取深度图，能较好的掌握复杂的三维结构层次，并将其复现。")]),e._v(" "),t("li",[t("code",[e._v("Normal Map")]),e._v(" 模型：从原图中提取 3D 物体的法线向量，绘制的新图与原图的光影效果完全相同。")])]),e._v(" "),t("p",[e._v("下面我们就使用相同提示词（Plaster statue of Abraham Lincoln），分别采用这两种模型来试试，这是 "),t("code",[e._v("Depth")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303042111757.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303042111118.png",alt:""}})]),e._v(" "),t("p",[e._v("这是 "),t("code",[e._v("Normal Map")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303042112062.png",alt:""}})]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303042112031.png",alt:""}})]),e._v(" "),t("p",[e._v("相比于 "),t("code",[e._v("Depth")]),e._v(" 模型，"),t("code",[e._v("Normal Map")]),e._v(" 模型能更好的保留几何形状，并且有更多的细节信息，注意看男人头发的形状。")]),e._v(" "),t("blockquote",[t("p",[e._v("注：建议 "),t("code",[e._v("Depth")]),e._v(" 模型用于 3D 场景，"),t("code",[e._v("Normal Map")]),e._v(" 模型用于 3D 物体。")])]),e._v(" "),t("h2",{attrs:{id:"四、试验特性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四、试验特性"}},[e._v("#")]),e._v(" 四、试验特性")]),e._v(" "),t("p",[e._v("我们先明确一点，提示词（Prompt、Negative Prompt）是使用 "),t("code",[e._v("SD")]),e._v(" 必不可少的一环，你需要对最终生成的图片进行描述，才能让 "),t("code",[e._v("SD")]),e._v(" 更准确的绘制出你要的图片效果，而 "),t("code",[e._v("ControlNet")]),e._v(" 只是以 "),t("code",[e._v("SD")]),e._v(" 为基础的功能扩展（更好的控制图片的生成，辅助性的），不是单独的程序。目前 "),t("code",[e._v("ControlNet")]),e._v(" 有 2 个强大但还处于试验阶段的功能，分别是：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Guess Mode")]),e._v("：猜测模式（或者叫 "),t("code",[e._v("non-prompt mode")]),e._v("）")]),e._v(" "),t("li",[t("code",[e._v("Multiple ControlNets")]),e._v("：多个 "),t("code",[e._v("ControlNet")])])]),e._v(" "),t("p",[t("code",[e._v("ControlNet")]),e._v(" 的 "),t("code",[e._v("Guess Mode")]),e._v("（猜测模式）的主要作用就是根据提供的参考图猜测你可能要使用的内容映射（深度？边缘？涂鸦？），即使在你不提供任何提示词（Prompt、Negative Prompt）的情况下，也能进行准确猜测。但实际测试的结果，并没有官方说的那么强（可能是我使用方法不对吧~），这里就有不多介绍了，感兴趣的可以阅读下官方介绍和案例：")]),e._v(" "),t("ul",[t("li",[t("code",[e._v("Guess Mode")]),e._v(" 介绍："),t("a",{attrs:{href:"https://github.com/lllyasviel/ControlNet#guess-mode--non-prompt-mode",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/lllyasviel/ControlNet#guess-mode--non-prompt-mode"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("下面主要来介绍 "),t("code",[e._v("Multiple ControlNets")]),e._v("，在搞懂它之前，我们先将该功能开启准备好。在 "),t("code",[e._v("Settings")]),e._v(" 页面中，找到 "),t("code",[e._v("ControlNet")]),e._v(" 分类，指定 "),t("code",[e._v("Multi ControlNet")]),e._v(" 的个数（默认为 1），点击 "),t("code",[e._v("Apply settings")]),e._v(" 保存配置，最后还得重启一次 "),t("code",[e._v("webui")]),e._v("：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303062336609.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：最多可以开启 10 个，根据情况调整即可。")])]),e._v(" "),t("p",[e._v("重启之后，再回到 txt2img 查看 ControlNet 选项，可以看到现在 ControlNet 选项中有 2 个 "),t("code",[e._v("ControlNet Model")]),e._v(" 子页面了：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303062342901.png",alt:""}})]),e._v(" "),t("p",[e._v("顾名思义，"),t("code",[e._v("Multiple ControlNets")]),e._v(" 就是开启多个 "),t("code",[e._v("ControlNet")]),e._v("，而 "),t("code",[e._v("ControlNet")]),e._v(" 是可组合的，当多个 "),t("code",[e._v("ControlNet")]),e._v(" 组合使用时，就可以对 "),t("code",[e._v("SD")]),e._v(" 进行多条件控制，将多个 "),t("code",[e._v("ControlNet")]),e._v(" 的产物，结合提示词（Prompt）绘制出图片，简单理解的话，就是多图合成。现在，我在没有使用 "),t("code",[e._v("Multiple ControlNets")]),e._v(" 的情况下，让 AI 绘制一张宇航员在彩色科幻山太空场景中的图片，效果如下：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303072317421.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("提示词：astronaut in colorful scifi mountain space scene")])]),e._v(" "),t("p",[e._v("看起来一切都很完美，但是呢，如果我想控制整个构图，比如背景轮廓（山体、地面、月亮等等），以及宇航员的姿态位置的话，应该怎么办呢？根据前面列举出来的所有 "),t("code",[e._v("ControlNet")]),e._v(" 模型效果可知，背景轮廓可以使用 "),t("code",[e._v("Depth")]),e._v(" 模型，能根据提供的背景参考图进行三维结构的复刻并重新着色风格化，而宇航员的姿态则可以使用 "),t("code",[e._v("openpose")]),e._v(" 模型进行控制。前面的所有案例，都是单个 "),t("code",[e._v("ControlNet")]),e._v(" 模型的使用，而现在，这里就可以使用 "),t("code",[e._v("Multiple ControlNets")]),e._v(" 组合多个 "),t("code",[e._v("ControlNet")]),e._v(" 模型来控图了。先来配置第 1 个 "),t("code",[e._v("ControlNet")]),e._v("，用来控制背景的 "),t("code",[e._v("Depth")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303072337980.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v('注：如果手上有现成的深度图，那么可以跳过预处理阶段（Preprocessor 配置为 "none"），缩短时间。另外，注意这个 '),t("code",[e._v("Weight")]),e._v(" 值我调整为 0.35 了，因为如果使用默认值 1 的话，与下面宇航员姿态的权重相当，最终生成的图片里宇航员的姿态不可控。")])]),e._v(" "),t("p",[e._v("再来配置第 2 个 "),t("code",[e._v("ControlNet")]),e._v("，用来控制宇航员姿态的 "),t("code",[e._v("openpose")]),e._v(" 模型：")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303072337285.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：这个骨架图使用了 "),t("code",[e._v("openpose-editor")]),e._v(" 插件制作，也是一个 "),t("code",[e._v("SD")]),e._v(" 插件，安装步骤参考本文中 "),t("code",[e._v("sd-webui-controlnet")]),e._v(" 插件的安装流程，除了 git 地址不同，其他都一样。")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/fkunn1326/openpose-editor",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/fkunn1326/openpose-editor"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v('这时再使用相同的提示词，点击 "Generate" 按钮，最终生成出来的图片效果如下：')]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303072348604.png",alt:""}})]),e._v(" "),t("blockquote",[t("p",[e._v("注：关注 "),t("a",{attrs:{href:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20210320170901/image/202203102224403.png",target:"_blank",rel:"noopener noreferrer"}},[t("code",[e._v("FSA全栈行动")]),t("OutboundLink")],1),e._v(' 微信公众号，回复 "彩色科幻山" 可获得原始效果图哦~❤️')])])])}),[],!1,null,null,null);t.default=_.exports}}]);