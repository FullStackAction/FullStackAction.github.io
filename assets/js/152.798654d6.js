(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{496:function(e,t,s){"use strict";s.r(t);var a=s(15),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"一、概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、概述"}},[e._v("#")]),e._v(" 一、概述")]),e._v(" "),t("p",[e._v("最近准备使用 "),t("code",[e._v("Flutter")]),e._v(" 的 "),t("code",[e._v("3.24")]),e._v(" 版本打包上架 "),t("code",[e._v("APP")]),e._v("，结果前天看到有人提了一个 "),t("code",[e._v("issue")]),e._v(": "),t("a",{attrs:{href:"https://github.com/flutter/flutter/issues/158423",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/flutter/flutter/issues/158423"),t("OutboundLink")],1),e._v(" ，说分别使用 "),t("code",[e._v("3.24.3")]),e._v(" 和 "),t("code",[e._v("3.24.4")]),e._v(" 提交苹果审核时，都惨遭被拒~")]),e._v(" "),t("p",[e._v("苹果反馈的信息如下：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Guideline 2.5.1 - Performance - Software Requirements\n\nThe app uses or references the following non-public or deprecated APIs:\n\nFrameworks/Flutter.framework/Flutter\n\nSymbols:\n\n• _kCTFontPaletteAttribute\n• _kCTFontPaletteColorsAttribute\n\nThe use of non-public or deprecated APIs is not permitted, as they can lead to a poor user experience should these APIs change and are otherwise not supported on Apple platforms.\n")])])]),t("p",[e._v("可以看到，是说 "),t("code",[e._v("Flutter")]),e._v(" 使用了未公开的 "),t("code",[e._v("API")]),e._v("，并且他使用 "),t("code",[e._v("strings")]),e._v(" 命令也验证了这一点。")]),e._v(" "),t("p",[t("code",[e._v("3.24.x")])]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("strings Runner.app/Frameworks/Flutter.framework/Flutter "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" kCT\nSkCTMShader\nkCTFontVariationAxisHiddenKey\nkCTFontPaletteAttribute\nkCTFontPaletteColorsAttribute\n")])])]),t("p",[t("code",[e._v("3.22.3")])]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("strings Runner.app/Frameworks/Flutter.framework/Flutter "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" kCT\nSkCTMShader\nkCTFontVariationAxisHiddenKey\n")])])]),t("p",[e._v("我先在 "),t("code",[e._v("Flutter")]),e._v(" 引擎源码中搜索，结果压根就搜索不到，随后打开了前几日编译好的引擎调试项目，结果一搜一个准，在 "),t("code",[e._v("third_party")]),e._v(" 依赖下的 "),t("code",[e._v("Skia")]),e._v(" 代码中，很快就定位到了引入未公开 "),t("code",[e._v("API")]),e._v(" 的相关提交记录 "),t("a",{attrs:{href:"https://skia-review.googlesource.com/c/skia/+/867836",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://skia-review.googlesource.com/c/skia/+/867836"),t("OutboundLink")],1),e._v(" 。")]),e._v(" "),t("p",[e._v("我一看完就啪的一声敲起来了，很快啊！上来就是一个 "),t("code",[e._v("Revert")]),e._v(" "),t("a",{attrs:{href:"https://skia-review.googlesource.com/c/skia/+/918416",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://skia-review.googlesource.com/c/skia/+/918416"),t("OutboundLink")],1),e._v(" 。")]),e._v(" "),t("p",[e._v("目前此次受影响的 "),t("code",[e._v("Flutter")]),e._v(" 版本范围暂时是 "),t("code",[e._v("3.24.0")]),e._v(" ~ "),t("code",[e._v("3.24.4")]),e._v("，得等待新版本的发布才可以解决。建议还没用上 "),t("code",[e._v("3.24")]),e._v(" 的小伙伴先不要升级，那如果已经是 "),t("code",[e._v("3.24")]),e._v(" 或者是一定要用 "),t("code",[e._v("3.24.4")]),e._v(" 及以下版本的小伙伴要怎么办呢？那就跟我一起来自编译引擎吧~")]),e._v(" "),t("h2",{attrs:{id:"二、编译引擎"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、编译引擎"}},[e._v("#")]),e._v(" 二、编译引擎")]),e._v(" "),t("h3",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[e._v("#")]),e._v(" 环境")]),e._v(" "),t("blockquote",[t("p",[e._v("注意：全程需要科学上网环境，请自行查找和配置")])]),e._v(" "),t("p",[e._v("首先拉取最新的 "),t("code",[e._v("depot_tools")]),e._v("，放到一个合适的位置，比如我放在 "),t("code",[e._v("~/development")]),e._v(" 目录下")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" ~/development\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n")])])]),t("p",[e._v("将 "),t("code",[e._v("depot_tools")]),e._v(" 添加至环境变量，在你的终端配置文件里补充如下内容")]),e._v(" "),t("blockquote",[t("p",[e._v("终端配置文件因人而异，如："),t("code",[e._v("~/.bash_profile")]),e._v("、"),t("code",[e._v("~/.zshrc")]),e._v("、"),t("code",[e._v("~/.zprofile")]),e._v("，请自行判断")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('export PATH = "$HOME/development/depot_tools":$PATH\n')])])]),t("p",[e._v("然后 "),t("code",[e._v("source ~/.zshrc")]),e._v("（这里请根据自身情况修改终端配置文件路径）")]),e._v(" "),t("h3",{attrs:{id:"拉源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉源码"}},[e._v("#")]),e._v(" 拉源码")]),e._v(" "),t("p",[e._v("找个合适的目录，创建 "),t("code",[e._v("engine")]),e._v(" 目录并进入")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("mkdir engine\ncd engine\n")])])]),t("p",[e._v("开始拉取源码")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("fetch flutter\n")])])]),t("p",[e._v("它会在当前目录下创建 "),t("code",[e._v(".gclient")]),e._v(" 文件，写好配置，并执行 "),t("code",[e._v("gclient sync")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('solutions = [\n  {\n    "custom_deps": {},\n    "deps_file": "DEPS",\n    "managed": False,\n    "name": "src/flutter",\n    "safesync_url": "",\n    "url": "https://github.com/flutter/engine.git",\n  },\n]\n')])])]),t("p",[e._v("如果在拉取代码的过程中遇到如下问题")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("remote: Enumerating objects: 835563, done.\nremote: Counting objects: 100% (1612/1612), done.\nremote: Compressing objects: 100% (1011/1011), done.\nerror: RPC failed; curl 92 HTTP/2 stream 5 was not closed cleanly: CANCEL (err 8)\nerror: 1481 bytes of body are still expected\nfetch-pack: unexpected disconnect while reading sideband packet\nfatal: early EOF\nfatal: fetch-pack: invalid index-pack output\n\nsrc/flutter (ERROR)\n----------------------------------------\n[0:00:00] Started.\n")])])]),t("p",[e._v("别慌，执行下方命令让其接着拉，直至完成")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("gclient "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sync")]),e._v("\n")])])]),t("p",[e._v("拉取完成后，去查看我们使用的 "),t("code",[e._v("Flutter")]),e._v(" 版本对应的引擎版本，这里以 "),t("code",[e._v("3.24.4")]),e._v(" 为例，打开链接：https://github.com/flutter/flutter/blob/3.24.4/bin/internal/engine.version ，拿到 "),t("code",[e._v("db49896cf25ceabc44096d5f088d86414e05a7aa")])]),e._v(" "),t("p",[e._v("执行如下命令进行切换")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("cd src/flutter\ngit checkout db49896cf25ceabc44096d5f088d86414e05a7aa\n")])])]),t("p",[e._v("执行完成会输出如下内容")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Previous HEAD position was b0a4ca92c4 Add FlPointerManager to process pointer events from GTK in a form suitable for Flutter. (#56443)\nHEAD is now at db49896cf2 [CP-stable]Add xcprivacy privacy manifest to macOS framework (#55366)\npost-checkout: The engine source tree has been updated.\n\nYou may need to run "gclient sync -D"\n')])])]),t("p",[e._v("按照提示执行")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("gclient sync -D\n")])])]),t("h3",{attrs:{id:"调整源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整源码"}},[e._v("#")]),e._v(" 调整源码")]),e._v(" "),t("p",[e._v("按路径 "),t("code",[e._v("engine/src/flutter/third_party/skia/src/ports/SkTypeface_mac_ct.cpp")]),e._v(" 打开文件，按下方内容进行修改（红：删除，绿：新增）")]),e._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[e._v("static CFStringRef getCTFontPaletteAttribute() {\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    static CFStringRef* kCTFontPaletteAttributePtr =\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('        static_cast<CFStringRef*>(dlsym(RTLD_DEFAULT, "kCTFontPaletteAttribute"));\n')]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    return *kCTFontPaletteAttributePtr;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    return nullptr;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    //static CFStringRef* kCTFontPaletteAttributePtr =\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('    //    static_cast<CFStringRef*>(dlsym(RTLD_DEFAULT, "kCTFontPaletteAttribute"));\n')]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    //return *kCTFontPaletteAttributePtr;\n")])]),e._v("}\nstatic CFStringRef getCTFontPaletteColorsAttribute() {\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    static CFStringRef* kCTFontPaletteColorsAttributePtr =\n")]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('        static_cast<CFStringRef*>(dlsym(RTLD_DEFAULT, "kCTFontPaletteColorsAttribute"));\n')]),t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    return *kCTFontPaletteColorsAttributePtr;\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    return nullptr;\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    //static CFStringRef* kCTFontPaletteColorsAttributePtr =\n")]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('    //    static_cast<CFStringRef*>(dlsym(RTLD_DEFAULT, "kCTFontPaletteColorsAttribute"));\n')]),t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    //return *kCTFontPaletteColorsAttributePtr;\n")])]),e._v("}\n\n...\n\nstatic bool apply_palette(CFMutableDictionaryRef attributes,\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("                         const SkFontArguments::Palette& palette) {\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("   bool changedAttributes = false;\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    if (palette.index != 0 || palette.overrideCount) {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    if ((palette.index != 0 || palette.overrideCount) && getCTFontPaletteAttribute()) {\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("       SkUniqueCFRef<CFNumberRef> paletteIndex(\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("               CFNumberCreate(kCFAllocatorDefault, kCFNumberIntType, &palette.index));\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("       CFDictionarySetValue(attributes, getCTFontPaletteAttribute(), paletteIndex.get());\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("       changedAttributes = true;\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("   }\n")])]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    if (palette.overrideCount) {\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("    if (palette.overrideCount && getCTFontPaletteColorsAttribute()) {\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("       SkUniqueCFRef<CFMutableDictionaryRef> overrides(\n")])]),e._v("\n...\n")])])]),t("p",[e._v("相应修改来自: "),t("a",{attrs:{href:"https://skia-review.googlesource.com/c/skia/+/918518",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://skia-review.googlesource.com/c/skia/+/918518"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[e._v("#")]),e._v(" 编译")]),e._v(" "),t("p",[e._v("来到 "),t("code",[e._v("engine/src")]),e._v(" 目录，使用 "),t("code",[e._v("gn")]),e._v(" 编译生成 "),t("code",[e._v("ninja")]),e._v(" 构建文件")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("./flutter/tools/gn --runtime-mode release --mac-cpu arm64\n./flutter/tools/gn --ios --runtime-mode release\n")])])]),t("p",[e._v("使用 "),t("code",[e._v("ninja")]),e._v(" 编译引擎的最终产物")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("ninja -C out/host_release_arm64\nninja -C out/ios_release\n")])])]),t("p",[e._v("如果你当前是 "),t("code",[e._v("MacOS 15")]),e._v(" 的 "),t("code",[e._v("Sequoia")]),e._v(" 系统，在执行 "),t("code",[e._v("ninja -C out/host_release_arm64")]),e._v(" 时会遇到如下错误")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("COPY '/System/Library/Fonts/A...arty/txt/assets/Apple Color Emoji.ttc'\nFAILED: gen/flutter/third_party/txt/assets/Apple Color Emoji.ttc\nln -f '/System/Library/Fonts/Apple Color Emoji.ttc' 'gen/flutter/third_party/txt/assets/Apple Color Emoji.ttc' 2>/dev/null || (rm -rf 'gen/flutter/third_party/txt/assets/Apple Color Emoji.ttc' && cp -af '/System/Library/Fonts/Apple Color Emoji.ttc' 'gen/flutter/third_party/txt/assets/Apple Color Emoji.ttc')\ncp: chflags: gen/flutter/third_party/txt/assets/Apple Color Emoji.ttc: Operation not permitted\n[18/4139] SOLINK libvk_swiftshader.dylib libvk_swiftshader.dylib.TOC\nninja: build stopped: subcommand failed.\n")])])]),t("p",[e._v("别急，打开 "),t("code",[e._v("engine/src/build/toolchain/mac/BUILD.gn")]),e._v("，做如下修改，修改完再执行 "),t("code",[e._v("gn")]),e._v(" 和 "),t("code",[e._v("ninja")])]),e._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('   tool("copy") {\n')])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[e._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('      command = "ln -f {{source}} {{output}} 2>/dev/null || (rm -rf {{output}} && cp -af {{source}} {{output}})"\n')])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[e._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('      command = "ln -f {{source}} {{output}} 2>/dev/null || (rsync -a --delete {{source}} {{output}})"\n')])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v('     description = "COPY {{source}} {{output}}"\n')]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[e._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[e._v("   }\n")])])])])]),t("p",[e._v("相应的 "),t("code",[e._v("issue")]),e._v(": "),t("a",{attrs:{href:"https://github.com/flutter/flutter/issues/152978",target:"_blank",rel:"noopener noreferrer"}},[e._v("#152978"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("好了，静静等待编译完成。")]),e._v(" "),t("p",[e._v("请注意，这将是个十分漫长且全程 "),t("code",[e._v("CPU")]),e._v(" 占用率为 "),t("code",[e._v("100%")]),e._v(" 的过程~")]),e._v(" "),t("p",[e._v("建议使用一台空闲的 "),t("code",[e._v("Mac")]),e._v(" 电脑去做这个事！否则你将啥活也干不了~")]),e._v(" "),t("h3",{attrs:{id:"验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[e._v("#")]),e._v(" 验证")]),e._v(" "),t("p",[e._v("进入 "),t("code",[e._v("engine/src/out/ios_release")])]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("strings Flutter.framework/Flutter "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" kCT\n\nSkCTMShader\nkCTFontVariationAxisHiddenKey\n")])])]),t("p",[e._v("可以看到，没有 "),t("code",[e._v("kCTFontPaletteAttribute")]),e._v(" 和 "),t("code",[e._v("kCTFontPaletteColorsAttribute")]),e._v("。")]),e._v(" "),t("h3",{attrs:{id:"使用本地引擎"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用本地引擎"}},[e._v("#")]),e._v(" 使用本地引擎")]),e._v(" "),t("p",[e._v("执行如下命令对项目进行编译")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("flutter build ipa "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--local-engine-src-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/Users/lxf/engine/src "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--local-engine"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("ios_release "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n--local-engine-host"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("host_release_arm64\n")])])]),t("p",[e._v("如果你有使用 "),t("code",[e._v("realm")]),e._v(" 的话，可能会遇到如下错误")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('Installing realm (1.0.3)\n[!] /bin/bash -c\nset -e\nsource "/Users/lxf/app/ios/Flutter/flutter_export_environment.sh" && cd "$FLUTTER_APPLICATION_PATH" && "$FLUTTER_ROOT/bin/flutter" pub run realm install --target-os-type ios --flavor flutter\n\nYou must specify --local-engine or --local-web-sdk if you are using a locally built engine or web sdk.\n')])])]),t("p",[e._v("你需要对该文件\n"),t("code",[e._v("/Users/lxf/app/ios/.symlinks/plugins/realm/ios/realm.podspec")]),e._v(" 进行修改，在 "),t("code",[e._v('\\"$FLUTTER_ROOT/bin/flutter\\"')]),e._v(" 和 "),t("code",[e._v("pub")]),e._v(" 中间加上引擎相关参数。如下所示")]),e._v(" "),t("div",{staticClass:"language-podspec extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('s.prepare_command           = "source \\"#{project_dir}/Flutter/flutter_export_environment.sh\\" && cd \\"$FLUTTER_APPLICATION_PATH\\" && \\"$FLUTTER_ROOT/bin/flutter\\" --local-engine-src-path /Users/lxf/engine/src --local-engine ios_release --local-engine-host host_release_arm64 pub run realm install --target-os-type ios --flavor flutter"\n\n:script => \'source "$PROJECT_DIR/../Flutter/flutter_export_environment.sh" && cd "$FLUTTER_APPLICATION_PATH" && "$FLUTTER_ROOT/bin/flutter" --local-engine-src-path /Users/lxf/engine/src --local-engine ios_release --local-engine-host host_release_arm64 pub run realm install --target-os-type ios --flavor flutter\',\n')])])]),t("p",[e._v("如果你只是想对项目进行配置，则将 "),t("code",[e._v("ipa")]),e._v(" 改为 "),t("code",[e._v("ios")]),e._v("，并加上 "),t("code",[e._v("--config-only")]),e._v(" 参数即可。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("flutter build ios \\\n--local-engine-src-path=/Users/lxf/engine/src \\\n--local-engine=ios_release \\\n--local-engine-host=host_release_arm64 \\\n--config-only\n")])])]),t("p",[e._v("以前使用本地引擎只需要 "),t("code",[e._v("--local-engine")]),e._v(" 参数，现在要求结合 "),t("code",[e._v("--local-engine-host")]),e._v(" 一块使用，这里附上相关 "),t("code",[e._v("issue")]),e._v("："),t("a",{attrs:{href:"https://github.com/flutter/flutter/issues/132245",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/flutter/flutter/issues/132245"),t("OutboundLink")],1),e._v(" ，想了解的可以点开看看")]),e._v(" "),t("h2",{attrs:{id:"三、最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三、最后"}},[e._v("#")]),e._v(" 三、最后")]),e._v(" "),t("p",[e._v("过程不难，麻烦的是拉源码和编译真的好慢，而且空间占用还大~")]),e._v(" "),t("p",[e._v("好了，本篇到此结束，感谢大家的支持，我们下次再见！ 👋")])])}),[],!1,null,null,null);t.default=r.exports}}]);