(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{500:function(t,a,s){"use strict";s.r(a);var e=s(21),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("抽空给之前做的开源项目"),a("a",{attrs:{href:"https://github.com/LinXunFeng/LXFWeChat",target:"_blank",rel:"noopener noreferrer"}},[t._v("【\b高仿微信】"),a("OutboundLink")],1),t._v("添加直播功能，由于时间有限，做得不是很完美，有空再去完善吧，能用就好~~")])]),t._v(" "),a("p",[t._v("在此提供存放于百度云的完整项目"),a("a",{attrs:{href:"https://pan.baidu.com/s/1bpB55Bx",target:"_blank",rel:"noopener noreferrer"}},[t._v("【\b高仿微信】- 百度云"),a("OutboundLink")],1),t._v("\n希望各位能在我的GitHub上献出一个宝贵的Star "),a("a",{attrs:{href:"https://github.com/LinXunFeng/LXFWeChat",target:"_blank",rel:"noopener noreferrer"}},[t._v("【\b高仿微信】- GitHub"),a("OutboundLink")],1),t._v("\n谢谢")]),t._v(" "),a("p",[t._v("注意：直播功能的使用（对方需要先进入到对应的聊天界面）")]),t._v(" "),a("blockquote",[a("p",[t._v("两个测试账号： lxf lqr  密码都是123456")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/LinXunFeng/LXFWeChat/raw/master/Screenshots/8.gif",alt:"\b直播聊天"}})]),t._v(" "),a("h2",{attrs:{id:"推流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推流"}},[t._v("#")]),t._v(" 推流")]),t._v(" "),a("p",[t._v("首先第一件事\b当然就是搭建一个推流服务器，\b这里请跳转参考我之前写好的文章吧"),a("RouterLink",{attrs:{to:"/pages/48f6d3/"}},[t._v("【Ubuntu安装nginx来搭建推流服务器】")]),t._v("，这里我的服务器的ip地址是：192.168.123.191")],1),t._v(" "),a("p",[t._v("APP上推流我使用的是第三方的库 "),a("a",{attrs:{href:"https://github.com/LaiFengiOS/LFLiveKit",target:"_blank",rel:"noopener noreferrer"}},[t._v("LFLiveKit"),a("OutboundLink")],1),t._v("，这个第三方库已经帮我们处理了很多事情，而且还包括美颜~~。当然，有时间我们还是要去了解一下底层的东西，这里就先不赘述，过几天抽空再做总结。")]),t._v(" "),a("p",[t._v("关键代码如下")]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" audioConfiguration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LFLiveAudioConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" videoConfiguration "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LFLiveVideoConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("low2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" outputImageOrientation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("portrait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化session")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LFLiveSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("audioConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" audioConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" videoConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" videoConfiguration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置代理")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// session?.delegate = self")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置展示的View")]),t._v("\nsession"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("preView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view\n")])])]),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" stream "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LFLiveStreamInfo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nstream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rtmp://192.168.123.191:1935/rtmplive/lxf"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务器地址")]),t._v("\nsession"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startLive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始推流")]),t._v("\nsession"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("running "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),a("h2",{attrs:{id:"拉流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉流"}},[t._v("#")]),t._v(" 拉流")]),t._v(" "),a("p",[t._v("这里我使用的是B站的开源库 "),a("a",{attrs:{href:"https://github.com/Bilibili/ijkplayer",target:"_blank",rel:"noopener noreferrer"}},[t._v("ijkplayer"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("为了方便可以用这个 "),a("a",{attrs:{href:"https://github.com/LinXunFeng/IJKFramework",target:"_blank",rel:"noopener noreferrer"}},[t._v("编译好的B站开源库"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("需要注意的是：IJKPlayer默认使用的是软解码(FFMpeng)，如果需要使用硬解码需要我们进行相应的设置")]),t._v(" "),a("div",{staticClass:"language-swift extra-class"},[a("pre",{pre:!0,attrs:{class:"language-swift"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// 设置"videotoolbox"的值为0为软解码(默认)，设置为1则是硬解码')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IJKFFOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("byDefault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\noptions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setOptionIntValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" forKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"videotoolbox"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" of"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("kIJKFFOptionCategoryPlayer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ijkPlayer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IJKFFMoviePlayerController")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contentURLString"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string-literal"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rtmp://192.168.123.191:1935/rtmplive/lxf"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" with"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需保存起来")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("self")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ijkPlayer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ijkPlayer\nijkPlayer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bounds\nview"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSubview")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ijkPlayer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 准备播放，当视频准备好的时候会自动进行播放")]),t._v("\nijkPlayer"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareToPlay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"将ijkplayer打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将ijkplayer打包"}},[t._v("#")]),t._v(" 将IJKPlayer打包")]),t._v(" "),a("p",[t._v("从B站的gitHub上下载的 "),a("a",{attrs:{href:"https://github.com/Bilibili/ijkplayer",target:"_blank",rel:"noopener noreferrer"}},[t._v("ijkplayer"),a("OutboundLink")],1),t._v(" 需要手动编译出来，跟着说明走就可以了，这里就不赘述咯，接下来我们将它打包，方便使用")]),t._v(" "),a("p",[t._v("如果你不跟着说明走的话会提示找不到 avformat.h 这个头文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202051.png",alt:"avformat.h"}})]),t._v(" "),a("p",[t._v("这时你需要在终端cd到ijkplayer这个目录，然后执行 init-ios.sh文件，如图")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202108.png",alt:"目录"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202120.png",alt:"init-ios.sh"}})]),t._v(" "),a("p",[t._v("然后经过一段漫长的时间之后，在ios目录下就多出了这些ffmpeg相关的目录")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202150.png",alt:"ffmpeg相关目录"}})]),t._v(" "),a("p",[t._v("这个操作是在下载ffmpeg源码，然缺失的avformat.h就在里面")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202202.png",alt:"avformat.h"}})]),t._v(" "),a("p",[t._v("打开项目 IJKMediaPlayer")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202248.png",alt:"打开项目"}})]),t._v(" "),a("p",[t._v("设置为 release，这样打出来的包会小些")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202313.png",alt:"Edit Scheme"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202327.png",alt:"release"}})]),t._v(" "),a("p",[t._v("选择真机和模拟器，各Command+B编译一次")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202343.png",alt:"\b真机"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202355.png",alt:"模拟器"}})]),t._v(" "),a("p",[t._v("右击，Show in Finder")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202406.png",alt:""}})]),t._v(" "),a("p",[t._v("如图，就有两个文件夹，里面存放着的就是我们编译出来的库")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202417.png",alt:"Paste_Image.png"}})]),t._v(" "),a("p",[t._v("可以使用如下命令查看信息")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("lipo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-info")]),t._v(" IJKMediaFramework\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202426.png",alt:"查看所支持的处理器"}})]),t._v(" "),a("p",[t._v("默认模拟器编译出来的包是不支持i386，如果希望支持的话\n进入项目的 Build Settings，将 Build Active Architecture Only 设置为NO")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202452.png",alt:"Build Active Architecture Only"}})]),t._v(" "),a("p",[t._v("好，现在对编译出来的包进行合并，这样就即支持真机，也支持模拟器")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("// 格式\n// lipo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-create")]),t._v("  path1  path2  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-output")]),t._v("  frameName\n\nlipo "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-create")]),t._v(" Release-iphoneos/IJKMediaFramework.framework/IJKMediaFramework Release-iphonesimulator/IJKMediaFramework.framework/IJKMediaFramework "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-output")]),t._v(" IJKMediaFramework\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202516.png",alt:"\b合并"}})]),t._v(" "),a("p",[t._v("将合并出来的IJKMediaFramework替换 IJKMediaFramework.framework中的IJKMediaFramework，最后将替换好的 IJKMediaFramework.framework 拖入到项目中使用即可。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210110202527.png",alt:"替换"}})]),t._v(" "),a("p",[t._v("最后，附上编译好的IJKMediaFramework")]),t._v(" "),a("p",[t._v("链接:https://pan.baidu.com/s/1eRYlJ7W 密码:9iaw")]),t._v(" "),a("div",{staticClass:"github-widget",attrs:{"data-repo":"LinXunFeng/LXFWeChat"}})])}),[],!1,null,null,null);a.default=n.exports}}]);