(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{443:function(t,e,a){"use strict";a.r(e);var s=a(21),n=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"一、创建应用并成为开发者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、创建应用并成为开发者"}},[t._v("#")]),t._v(" 一、创建应用并成为开发者")]),t._v(" "),e("h3",{attrs:{id:"_1、创建应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建应用"}},[t._v("#")]),t._v(" 1、创建应用")]),t._v(" "),e("h4",{attrs:{id:"_1-到微信开放平台管理中心-点击-创建移动应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-到微信开放平台管理中心-点击-创建移动应用"}},[t._v("#")]),t._v(" 1)到微信开放平台管理中心，点击“创建移动应用”")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210107083647.png",alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_2-填写基本的应用信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-填写基本的应用信息"}},[t._v("#")]),t._v(" 2)填写基本的应用信息")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210107083703.png",alt:""}})]),t._v(" "),e("h4",{attrs:{id:"_3-填写平台信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-填写平台信息"}},[t._v("#")]),t._v(" 3)填写平台信息")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210107083719.png",alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("这里还是说一下怎么获取应用签名吧：")])]),t._v(" "),e("ol",[e("li",[e("p",[t._v("到“资源中心”--\x3e“资源下载”--\x3e“Android资源下载”，找到“签名生成工具”下载即可。"),e("a",{attrs:{href:"https://res.wx.qq.com/open/zh_CN/htmledition/res/dev/download/sdk/Gen_Signature_Android2.apk",target:"_blank",rel:"noopener noreferrer"}},[t._v("飞机直达:Gen_Signature_Android2"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("将APP进行打包安装到手机（如果是在IDE中直接运行后安装的话，是使用debug签名的，跟上线后使用jks文件签名的不一样!!!）")])]),t._v(" "),e("li",[e("p",[t._v("给手机安装第一步中下载的签名工具，打开后输入APP的包名(包名是AndroidManifest.xml中package的值)，点击生成，就可以看到应用签名了。")])])]),t._v(" "),e("blockquote",[e("p",[t._v("*"),e("strong",[t._v("注意：")])])]),t._v(" "),e("blockquote",[e("p",[t._v("签名工具得到的签名根你APP的打包步骤有关，默认的debug和jks文件签名，结果是不一样，如果app签名与微信开放平台的不一样，将无法调出微信登录界面!!!")])]),t._v(" "),e("h4",{attrs:{id:"_4-最后提交-等待审核。-说是7天-一般1天后就审核通过了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-最后提交-等待审核。-说是7天-一般1天后就审核通过了"}},[t._v("#")]),t._v(" 4)最后提交，等待审核。（说是7天，一般1天后就审核通过了）")]),t._v(" "),e("h3",{attrs:{id:"_2、成为开发者"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、成为开发者"}},[t._v("#")]),t._v(" 2、成为开发者")]),t._v(" "),e("p",[t._v("很简单，去“个人中心”，找到“开发者资质认证”，点击“申请”，然后一步步按要示填写信息，最后交钱就行，300大洋~~")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210107083736.png",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"二、微信登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、微信登录"}},[t._v("#")]),t._v(" 二、微信登录")]),t._v(" "),e("p",[t._v("当审核通过之后，就可以开始使用微信开放平台提供的功能了。要使用“微信登录”功能必须成功开放者，也就是交了300块后默认开通此功能。")]),t._v(" "),e("p",[t._v("在这里可以得到AppId和AppSecret，记下，之后会用到。如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource/image/20210107083753.png",alt:""}})]),t._v(" "),e("h3",{attrs:{id:"_1、引入微信sdk依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、引入微信sdk依赖"}},[t._v("#")]),t._v(" 1、引入微信SDK依赖")]),t._v(" "),e("h4",{attrs:{id:"_1-android-studio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-android-studio"}},[t._v("#")]),t._v(" 1)Android Studio:")]),t._v(" "),e("p",[t._v("在build.gradle的dependencies中加入以下语句")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("compile 'com.tencent.mm.opensdk:wechat-sdk-android-with-mta:1.0.2'\n")])])]),e("h4",{attrs:{id:"_2-eclipse-adt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-eclipse-adt"}},[t._v("#")]),t._v(" 2)Eclipse(ADT):")]),t._v(" "),e("p",[t._v("去微信开放平台，“资源中心”--\x3e“资源下载”--\x3e“Android资源下载”，找到“开发工具包（SDK）”后下载。"),e("a",{attrs:{href:"https://res.wx.qq.com/open/zh_CN/htmledition/res/dev/download/sdk/Android_SDK_4.0.2.zip",target:"_blank",rel:"noopener noreferrer"}},[t._v("飞机直达:Android_SDK_4.0.2.zip"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("解压后找到lib文件夹，把wechat-sdk-android-with-mta-1.0.2.jar和wechat-sdk-android-without-mta-1.0.2.jar复制到工程lib文件夹下，rebuild一下。")]),t._v(" "),e("h3",{attrs:{id:"_2、申明应用权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、申明应用权限"}},[t._v("#")]),t._v(" 2、申明应用权限")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v('<uses-permission android:name="android.permission.INTERNET"/> \n<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/> \n<uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/> \n<uses-permission android:name="android.permission.READ_PHONE_STATE"/> \n<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/> \n')])])]),e("h3",{attrs:{id:"_3、向微信注册app"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、向微信注册app"}},[t._v("#")]),t._v(" 3、向微信注册APP")]),t._v(" "),e("p",[t._v("在自定义的Application的onCreate中调用registToWX方法：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("@Override\npublic void onCreate() {\n    super.onCreate();\n    registToWX();\n}\n\nprivate void registToWX() {\n\t//AppConst.WEIXIN.APP_ID是指你应用在微信开放平台上的AppID，记得替换。\n    mWxApi = WXAPIFactory.createWXAPI(this, AppConst.WEIXIN.APP_ID, false);\n    // 将该app注册到微信\n    mWxApi.registerApp(AppConst.WEIXIN.APP_ID);\n}\n")])])]),e("h3",{attrs:{id:"_4、调用微信登录界面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、调用微信登录界面"}},[t._v("#")]),t._v(" 4、调用微信登录界面")]),t._v(" "),e("p",[t._v("一般会在登录界面会有一个微信图标，对微信图标设置点击事件，调用如下方法：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v('public void wxLogin() {\n    if (!MyApp.mWxApi.isWXAppInstalled()) {\n        UIUtils.showToast("您还未安装微信客户端");\n        return;\n    }\n    final SendAuth.Req req = new SendAuth.Req();\n    req.scope = "snsapi_userinfo";\n    req.state = "diandi_wx_login";\n    MyApp.mWxApi.sendReq(req);\n}\n')])])]),e("p",[t._v("至此，就可以调用微信登录界面来进行登录认证了。")]),t._v(" "),e("h3",{attrs:{id:"_5、创建wxentryactivity-java微信接收响应"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、创建wxentryactivity-java微信接收响应"}},[t._v("#")]),t._v(" 5、创建WXEntryActivity.java微信接收响应")]),t._v(" "),e("p",[t._v("WXEntryActivity是一个Activity，用来接收微信的响应信息。这里有几个需要注意的地方：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v('它必须在"包名.wxapi"这个包下，如：你的应用包名为：com.lqr.test，则WXEntryActivity所在的包名必须为com.lqr.test.wxapi。')])]),t._v(" "),e("li",[e("p",[t._v('创建后在AndroidManifest.xml文件中对WXEntryActivity进行设置：android:exported="true"。')]),t._v(" "),e("activity",{attrs:{"android:name":".wxapi.WXEntryActivity","android:exported":"true"}})],1),t._v(" "),e("li",[e("p",[t._v("WXEntryActivity.Java继承自Activity,实现IWXAPIEventHandler接口，该接口即处理微信和app通信的不同event。")])])]),t._v(" "),e("p",[t._v("以下是一个示例：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v('public class WXEntryActivity extends Activity implements IWXAPIEventHandler {\n    private static final int RETURN_MSG_TYPE_LOGIN = 1;\n    private static final int RETURN_MSG_TYPE_SHARE = 2;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        \n        //如果没回调onResp，八成是这句没有写\n        MyApp.mWxApi.handleIntent(getIntent(), this);\n    }\n\n    // 微信发送请求到第三方应用时，会回调到该方法\n    @Override\n    public void onReq(BaseReq req) {\n    }\n\n    // 第三方应用发送到微信的请求处理后的响应结果，会回调到该方法\n    //app发送消息给微信，处理返回消息的回调\n    @Override\n    public void onResp(BaseResp resp) {\n        LogUtils.sf(resp.errStr);\n        LogUtils.sf("错误码 : " + resp.errCode + "");\n        switch (resp.errCode) {\n\n            case BaseResp.ErrCode.ERR_AUTH_DENIED:\n            case BaseResp.ErrCode.ERR_USER_CANCEL:\n                if (RETURN_MSG_TYPE_SHARE == resp.getType()) UIUtils.showToast("分享失败");\n                else UIUtils.showToast("登录失败");\n                break;\n            case BaseResp.ErrCode.ERR_OK:\n                switch (resp.getType()) {\n                    case RETURN_MSG_TYPE_LOGIN:\n                        //拿到了微信返回的code,立马再去请求access_token\n                        String code = ((SendAuth.Resp) resp).code;\n\t\t\t\t\t\tLogUtils.sf("code = " + code);\n\n                        //就在这个地方，用网络库什么的或者自己封的网络api，发请求去咯，注意是get请求\n                        \n                        break;\n\n                    case RETURN_MSG_TYPE_SHARE:\n                        UIUtils.showToast("微信分享成功");\n                        finish();\n                        break;\n                }\n                break;\n        }\n    }\n}\n')])])]),e("p",[t._v("当微信授权第三登录后，会自动调用WXEntryActivity的onResp方法，可以在((SendAuth.Resp) resp).code得到“授权临时票据code”,之后可以通过code参数加上AppID和AppSecret等，通过API换取access_token,再通过access_token进行接口调用，获取用户基本数据资源或帮助用户实现基本操作。")]),t._v(" "),e("p",[t._v("一般会把获取access_token步骤（包括之后的操作）放到服务器那边，服务器经过一番处理之后，返回用户信息给客户端。")]),t._v(" "),e("h2",{attrs:{id:"三、踩坑经验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、踩坑经验"}},[t._v("#")]),t._v(" 三、踩坑经验")]),t._v(" "),e("p",[t._v("在app点击微信图标后，一片空白！！控制台打印错误码为-6。\n原因：\n这是因为app的使用的签名跟开放平台的应用签名不一致导致的。")]),t._v(" "),e("p",[t._v("解决方法：")]),t._v(" "),e("ol",[e("li",[t._v("使用签名工具得到手机中app的签名")]),t._v(" "),e("li",[t._v("修改开放平台上的应用签名")]),t._v(" "),e("li",[t._v("清除手机上微信APP的缓存信息（不知道的可以卸载后重装微信）")]),t._v(" "),e("li",[t._v("登录微信后，再点击APP的微信登录图标")])])])}),[],!1,null,null,null);e.default=n.exports}}]);