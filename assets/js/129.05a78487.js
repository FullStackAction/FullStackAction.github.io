(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{538:function(t,s,e){"use strict";e.r(s);var a=e(21),n=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、depot-tools"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、depot-tools"}},[t._v("#")]),t._v(" 一、depot_tools")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up",target:"_blank",rel:"noopener noreferrer"}},[t._v("depot_tools"),s("OutboundLink")],1),t._v(" 是调试 "),s("code",[t._v("Flutter")]),t._v(" 引擎的必备工具包，包含了 "),s("code",[t._v("gclient")]),t._v("、"),s("code",[t._v("gn")]),t._v(" 和 "),s("code",[t._v("ninja")]),t._v(" 等工具，这些在下面会用到！")])]),t._v(" "),s("p",[t._v("拉取 "),s("code",[t._v("depot_tools")]),t._v(" 到本地，我一般是放到 "),s("code",[t._v("~/developer/")]),t._v(" 下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n")])])]),s("p",[t._v("将 "),s("code",[t._v("depot_tools")]),t._v(" 的路径补充到 "),s("code",[t._v("PATH")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/path/to/depot_tools:"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如: export PATH=~/developer/depot_tools:$PATH")]),t._v("\n")])])]),s("h2",{attrs:{id:"二、配置-gclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、配置-gclient"}},[t._v("#")]),t._v(" 二、配置.gclient")]),t._v(" "),s("p",[t._v("创建 "),s("code",[t._v("engine")]),t._v(" 目录，且终端进入到该目录，生成并配置 "),s("code",[t._v(".gclient")]),t._v(" 文件")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("➜  ~ cd /Users/lxf/Desktop/LXF/engine\n➜  engine touch .gclient\n➜  engine vim .gclient\n")])])]),s("p",[t._v("配置内容:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("solutions = "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"managed"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" False"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src/flutter"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@github.com:flutter/engine.git@1837b5be5f0f1376a1ccf383950e83a80177fb4e"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"custom_deps"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deps_file"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DEPS"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"safesync_url"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("如果你是仅调试，那链接可以用 "),s("code",[t._v("flutter")]),t._v(" 的，但如果你想后面提 "),s("code",[t._v("PR")]),t._v("，则需要使用自己 "),s("code",[t._v("fork")]),t._v(" 后的链接，如："),s("code",[t._v("git@github.com:LinXunFeng/engine.git")])]),t._v(" "),s("p",[t._v("引擎 "),s("code",[t._v("git")]),t._v(" 地址后面携带的 "),s("code",[t._v("commit id")]),t._v(" 最好与当前 "),s("code",[t._v("Flutter")]),t._v(" 所使用的引擎版本保持一致，可以通过如下命令获取")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("flutter "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v("\n")])])]),s("p",[t._v("输出:")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Flutter "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.7")]),t._v(".7 • channel stable • \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nEngine • revision 1837b5be5f\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[t._v("或者取如下文件里的值")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("flutter/bin/internal/engine.version\n\n# 1837b5be5f0f1376a1ccf383950e83a80177fb4e\n")])])]),s("h2",{attrs:{id:"三、拉取源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、拉取源码"}},[t._v("#")]),t._v(" 三、拉取源码")]),t._v(" "),s("p",[t._v("使用终端，进行到 "),s("code",[t._v(".gclient")]),t._v(" 所在目录，即上面创建的 "),s("code",[t._v("engine")]),t._v(" 目录，执行如下命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("gclient "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n")])])]),s("p",[t._v("注："),s("code",[t._v("gclient")]),t._v(" 命令来自于 "),s("code",[t._v("depot_tools")])]),t._v(" "),s("p",[t._v("然后坐等完成即可，如果失败了就反复执行 "),s("code",[t._v("gclient sync")]),t._v(" 直到成功，大概近10个G")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  engine gclient "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\nUpdating depot_tools"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nusing /var/folders/36/n74_k53x5h5fz70gkd3jr5p00000gn/T/goma_lxf as tmpdir\nINFO: creating cache "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/var/folders/36/n74_k53x5h5fz70gkd3jr5p00000gn/T/goma_lxf/goma_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(".\ncompiler_proxy is not running\n\n________ running "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'git -c core.deltaBaseCacheLimit=2g clone --no-checkout --progress git@github.com:flutter/engine.git /Users/lxf/Desktop/LXF/engine/src/_gclient_flutter_t0dh3d3h'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/Users/lxf/Desktop/LXF/engine'")]),t._v("\nCloning into "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/Users/lxf/Desktop/LXF/engine/src/_gclient_flutter_t0dh3d3h'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nremote: Enumerating objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("326233")]),t._v(", done.\nremote: Counting objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),t._v("/42"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", done.\nremote: Compressing objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("39")]),t._v("/39"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", done.\nremote: Total "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("326233")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delta "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", reused "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delta "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", pack-reused "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("326191")]),t._v("\nReceiving objects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("326233")]),t._v("/326233"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("394.55")]),t._v(" MiB "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.88")]),t._v(" MiB/s, done.\nResolving deltas: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("242690")]),t._v("/242690"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", done.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v("WARNING: subprocess "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"git" "-c" "core.deltaBaseCacheLimit=2g" "fetch" "origin" "d40d15e994ed60d32bcfc9ab87004dfb028dfbd6" "--no-tags"\'')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/third_party/harfbuzz failed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" will retry after a short nap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSyncing projects: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("134")]),t._v("/134"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", done.\nHook "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python3 src/flutter/tools/pub_get_offline.py'")]),t._v(" took "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19.13")]),t._v(" secs\nRunning hooks: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("/11"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", done.\n➜  engine\n")])])]),s("p",[t._v("拉取完成后你可以进入 "),s("code",[t._v("src/flutter")]),t._v(" 查看当前下载下来的 "),s("code",[t._v("engine")]),t._v(" 的 "),s("code",[t._v("commit id")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/flutter\n➜  flutter git:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1837b5be5f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("如果你的终端没有显示 "),s("code",[t._v("git:(commit id)")]),t._v("，那可以使用如下命令进行查看")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" rev-parse HEAD\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1837b5be5f0f1376a1ccf383950e83a80177fb4e")]),t._v("\n")])])]),s("h2",{attrs:{id:"四、编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、编译"}},[t._v("#")]),t._v(" 四、编译")]),t._v(" "),s("p",[t._v("进入 "),s("code",[t._v("tools")]),t._v(" 目录，执行几条 "),s("code",[t._v("gn")]),t._v(" 命令")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" engine/src/flutter/tools\n")])])]),s("p",[t._v("生成 "),s("code",[t._v("iOS")]),t._v(" 设备端可执行文件所需的构建文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  tools git:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1837b5be5f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ./gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ios")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n\nGOMA usage was specified but can't be found, falling back to "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" builds. Set the GOMA_DIR environment variable to fix GOMA.\nGenerating GN files in: out/ios_debug_unopt\nGenerating Xcode projects took 211ms\nGenerating compile_commands took 55ms\nDone. Made "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("801")]),t._v(" targets from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("274")]),t._v(" files "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" 6165ms\n")])])]),s("p",[t._v("如果你想调试模拟器，则加上 "),s("code",[t._v("--simulator")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--ios")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--simulator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n")])])]),s("p",[t._v("生成主机端可执行文件所需的构建文件")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("➜  tools git:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1837b5be5f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ./gn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--unoptimized")]),t._v("\n\nGOMA usage was specified but can't be found, falling back to "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v(" builds. Set the GOMA_DIR environment variable to fix GOMA.\nUsing prebuilt Dart SDK binary. If you are editing Dart sources and wish to compile the Dart SDK, "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("--no-prebuilt-dart-sdk"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\nGenerating GN files in: out/host_debug_unopt\nGenerating Xcode projects took 273ms\nGenerating compile_commands took 70ms\nDone. Made "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1110")]),t._v(" targets from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("340")]),t._v(" files "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" 46800ms\n")])])]),s("p",[t._v("执行完成之后，在 "),s("code",[t._v("engine/src/out")]),t._v(" 目录下就会多出相应端的构建文件目录")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303121745138.png",alt:""}})]),t._v(" "),s("p",[t._v("接下来使用 "),s("code",[t._v("Ninja")]),t._v(" 进行编译")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" host_debug_unopt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ninja "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-C")]),t._v(" ios_debug_unopt\n")])])]),s("p",[t._v("如果你是用 "),s("code",[t._v("M1/M2")]),t._v(" 电脑去编译旧引擎源码，可能会在编译 "),s("code",[t._v("ios_debug_unopt")]),t._v(" 时遇到如下错误")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ninja: Entering directory "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("host_debug_unopt'\nninja: no work to do.\nninja: Entering directory "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("ios_debug_unopt'\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),t._v("/369"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ACTION //flutter/lib/snapshot:create_arm_gen_snapshot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("//build/toolchain/mac:ios_clang_arm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nFAILED: clang_x64/gen_snapshot_arm64\npython3 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/flutter/sky/tools/create_macos_gen_snapshots.py "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--dst")]),t._v(" /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_unopt/clang_x64 --arm64-out-dir /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_unopt\nCannot "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" gen_snapshot at /Users/lxf/Desktop/LXF/engine/src/out/ios_debug_unopt/clang_x64/gen_snapshot\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("/369"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" LINK clang_arm64/impellerc\nninja: build stopped: subcommand failed.\n")])])]),s("p",[t._v("这时你只需要进入到 "),s("code",[t._v("engine/src/out/ios_debug_unopt")]),t._v(" 目录下，将 "),s("code",[t._v("clang_arm64")]),t._v(" 目录中的 "),s("code",[t._v("gen_snapshot")]),t._v(" 拷贝到 "),s("code",[t._v("clang_x64")]),t._v("，然后再继续执行 "),s("code",[t._v("ninja -C ios_debug_unopt")]),t._v(" 即可。")]),t._v(" "),s("p",[t._v("这里强调一下：")]),t._v(" "),s("ul",[s("li",[t._v("如果你修改了引擎的源代码，需要重新执行相应的 "),s("code",[t._v("ninja")]),t._v(" 命令，如调试引擎时我们会修改代码，如果不执行 "),s("code",[t._v("ninja")]),t._v(" 命令，你会发现断点修改的代码其它是旧代码！")]),t._v(" "),s("li",[t._v("如果是新增或删除文件，则需要先执行 "),s("code",[t._v("gn")]),t._v(" 命令，再执行 "),s("code",[t._v("ninja")]),t._v(" 命令。")]),t._v(" "),s("li",[t._v("我建议直接 "),s("code",[t._v("gn")]),t._v(" 和 "),s("code",[t._v("ninja")]),t._v(" 命令一起执行，不用管什么情况，脚本会自己检查是否有文件变更，以及是否需要重新生成相应的文件的。")])]),t._v(" "),s("h2",{attrs:{id:"五、调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、调试"}},[t._v("#")]),t._v(" 五、调试")]),t._v(" "),s("p",[t._v("打开你的"),s("code",[t._v("Flutter")]),t._v(" 项目，"),s("code",[t._v("IDE")]),t._v(" 以 "),s("code",[t._v("VSCode")]),t._v(" 为例，添加 "),s("code",[t._v("--local-engine-src-path")]),t._v(" 和 "),s("code",[t._v("--local-engine")]),t._v(" 两个参数，完整配置如下")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flutter_demo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"request"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"launch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dart"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"args"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--local-engine-src-path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/lxf/Desktop/LXF/engine/src"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--local-engine"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ios_debug_unopt"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("--local-engine-src-path")])]),t._v(" "),s("td",[t._v("固定为引擎的 "),s("code",[t._v("src")]),t._v(" 路径")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("--local-engine")])]),t._v(" "),s("td",[t._v("真机: "),s("code",[t._v("ios_debug_unopt")]),s("br"),t._v("模拟器: "),s("code",[t._v("ios_debug_sim_unopt")])])])])]),t._v(" "),s("p",[t._v("按 "),s("code",[t._v("F5")]),t._v(" 跑一遍就可以使用指定引擎运行 "),s("code",[t._v("Flutter")]),t._v(" 项目了。")]),t._v(" "),s("p",[t._v("细心的你可能会发现在 "),s("code",[t._v("flutter_demo/ios/Flutter/Generated.xcconfig")]),t._v(" 配置文件内新增相应的两个环境变量")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FLUTTER_ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/Users/lxf/Desktop/LXF/engine/src\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LOCAL_ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ios_debug_unopt\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),s("p",[t._v("如果我们要调试引擎代码，请打开你的 "),s("code",[t._v("Runner.xcworkspace")]),t._v("，然后将 "),s("code",[t._v("flutter_engine")]),t._v(" 拖入项目")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303121745765.png",alt:""}})]),t._v(" "),s("p",[t._v("找到 "),s("code",[t._v("FlutterViewController.mm")]),t._v(" 给 "),s("code",[t._v("touchesBegan")]),t._v(" 打个断点，再运行项目，点击屏幕就会进入到断点处，现在就可以开始愉快的调试 "),s("code",[t._v("flutter_engine")]),t._v(" 了")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/FullStackAction/PicBed@resource20220417121922/image/202303121745762.png",alt:""}})]),t._v(" "),s("p",[t._v("如果你的断点不生效，那请先检查 "),s("code",[t._v("Generated.xcconfig")]),t._v(" 里的 "),s("code",[t._v("FLUTTER_ENGINE")]),t._v(" 和 "),s("code",[t._v("LOCAL_ENGINE")]),t._v(" 变量。")]),t._v(" "),s("p",[t._v("到这里，引擎的编译调试就介绍完毕了。")]),t._v(" "),s("p",[t._v("下一篇，我们来详细说说怎么给 "),s("code",[t._v("Flutter")]),t._v(" 引擎提交 "),s("code",[t._v("PR")]),t._v(" 🤠")]),t._v(" "),s("h2",{attrs:{id:"六、资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、资料"}},[t._v("#")]),t._v(" 六、资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/flutter/flutter/wiki/Setting-up-the-Engine-development-environment",target:"_blank",rel:"noopener noreferrer"}},[t._v("Setting up the Engine development environment"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/flutter/flutter/wiki/Compiling-the-engine#compiling-for-ios-from-macos",target:"_blank",rel:"noopener noreferrer"}},[t._v("Compiling the engine"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);